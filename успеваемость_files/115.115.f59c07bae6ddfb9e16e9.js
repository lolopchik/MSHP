(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{1925:function(t,r,a){"use strict";a.d(r,"d",(function(){return i})),a.d(r,"a",(function(){return l})),a.d(r,"b",(function(){return u})),a.d(r,"c",(function(){return _}));var o=a(520),c=a(427),i={fields:["id","missed_class_time_id","lesson_processing_id"]},l={fields:["id","lesson_processing_id","missed_class_time_id"],lesson_processing:{fields:["id","pupil_id","status"]}},u={fields:["id"],missed_class_time:o.f},_={fields:["id","missed_class_time_id"],missed_class_time:o.f,pupil_attendances:c.a}},1984:function(t,r,a){"use strict";a.d(r,"a",(function(){return i})),a.d(r,"b",(function(){return l}));a(33),a(36),a(25),a(7),a(23),a(28),a(38);var o=a(13),c=a.n(o);function ownKeys(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),a.push.apply(a,o)}return a}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(a),!0).forEach((function(r){c()(t,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))}))}return t}var i={fields:["id","month","month_till","report","contract_id","fee","amount","json_report"]},l=_objectSpread(_objectSpread({},i),{},{corrections:{fields:["id","fee","amount","contract_id","status","date","correction_date","reason","invoice_id"]}})},1987:function(t,r,a){"use strict";a.d(r,"c",(function(){return i})),a.d(r,"b",(function(){return l})),a.d(r,"a",(function(){return u}));var o=a(10),c=a.n(o),i=(a(31),{fields:["amount","rate","amount_to_pay","description","status","order_number","error_message"]}),l={fields:[].concat(c()(i.fields),["proxy_url","publishable_key","acquiring_type","order_id","currency","return_url"])},u={fields:["id","order_id","contract_id","created_at"]}},2044:function(t,r,a){"use strict";a(11),a(7),a(12);var o=a(953),c=a(497),i=a(324),l=a(22),u={name:"FileDownloadPreview",components:{InstanceFetcher:i.a},props:{file_log:{type:c.a,required:!0}},data:function data(){return{file_log_model:o.a}},computed:{download_link:function download_link(){return l.b["api:file_log_download_api"](this.file_log.values.id)}}},_=a(3),d=Object(_.a)(u,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",["html"===t.file_log.values.extension?a("div",{staticClass:"embed-responsive embed-responsive-16by9 sticky-modal-content "},[a("instance-fetcher",{attrs:{model:t.file_log_model,url:"api:file_log_detail_api",instance_id:t.file_log.values.id}},[t.file_log.values.content?a("iframe",{staticClass:"embed-responsive-item",attrs:{type:"text/html",srcdoc:t.file_log.values.content,frameborder:"0",webkitallowfullscreen:"",mozallowfullscreen:"",allowfullscreen:""}}):a("div",{staticClass:"text-center lead"},[t._v(t._s(t.$gettext("Файл не доступен для просмотра")))])])],1):[t._t("download",(function(){return[a("a",{attrs:{href:t.download_link}},[t._v("\n        "+t._s(t.$gettext("Скачать"))+"\n      ")])]}),{href:t.download_link})]],2)}),[],!1,null,null,null);r.a=d.exports},2056:function(t,r,a){"use strict";a.d(r,"a",(function(){return c})),a.d(r,"b",(function(){return i}));var o=a(1925),c={fields:["id","pupil_id","status","type","date","date_till","sickness_certificate_id"],missed_classes:o.d},i={fields:["id","date","date_till"],missed_classes:o.c}},2109:function(t,r,a){"use strict";a.d(r,"a",(function(){return y})),a.d(r,"c",(function(){return b})),a.d(r,"b",(function(){return g}));a(33),a(36),a(25),a(7),a(23),a(28),a(38);var o=a(10),c=a.n(o),i=a(13),l=a.n(i),u=(a(31),a(215)),_={fields:["id","fee","amount","contract_id","month","month_end","currency"]},d=a(1984),p=a(2110);function ownKeys(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),a.push.apply(a,o)}return a}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(a),!0).forEach((function(r){l()(t,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))}))}return t}var m={fields:["id","amount","type","to_contract_balance_by_month_id","from_contract_balance_by_month_id","created_at","from_payment_id","from_sickness_certificate_id","to_refund_id","to_invoice_by_month_id"]},h=_objectSpread(_objectSpread({},m),{},{to_contract_balance_by_month:_,to_invoice_by_month:d.b}),v=_objectSpread(_objectSpread({},m),{},{from_payment:{fields:["id","account","amount","pupil_id","contract_id","status","number","date","bank_name","payer","distribute_at_month","BIC","correspondent","note","school_id","official_school_id","from_acquiring","payment_order_id","fee","amount","ofd_error"]},from_contract_balance_by_month:_,from_sickness_certificate:p.b});function schemas_ownKeys(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),a.push.apply(a,o)}return a}function schemas_objectSpread(t){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?schemas_ownKeys(Object(a),!0).forEach((function(r){l()(t,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):schemas_ownKeys(Object(a)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))}))}return t}var y=schemas_objectSpread(schemas_objectSpread({},_),{},{contract:u.b,from_cash_transfers:h,to_cash_transfers:v}),b=schemas_objectSpread(schemas_objectSpread({},_),{},{contract:u.e}),g={fields:[].concat(c()(_.fields),["is_published"]),invoice:d.a}},2110:function(t,r,a){"use strict";a.d(r,"b",(function(){return l})),a.d(r,"a",(function(){return u}));var o=a(69),c={fields:["id","contract_number"],pupil_courses:{fields:["id","course_id","date_from","date_till","contract_id","course_type"],classes_users:a(1833).h,course:o.i}},i=a(2056),l={fields:["id","fee","amount","pupil_id","date_from","date_till","compensated_amount","status","issued_by","balance_id","has_document"]},u={fields:["id","date_from","date_till"],contracts:c,processings:i.a}},2253:function(t,r,a){"use strict";var o=a(324),c=a(2044),i=a(458),l=a(233),u={name:"ClientContractViewModal",components:{ModernShpModal:a(127).a,InstanceFetcher:o.a,FileDownloadPreview:c.a},props:{contract:{required:!0,type:i.a}},data:function data(){return{open:!0,contract_model:l.a,ContractData:i.a}}},_=a(3),d=Object(_.a)(u,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("ModernShpModal",{attrs:{size:"xl","append-to-body":"",gettext:"Просмотр",title:t.$gettext("Просмотр")+" "+t.contract.values.contract_number,footer:!1},on:{hide:function(r){return t.contract.action_operator.detail(t.$store)}},model:{value:t.open,callback:function(r){t.open=r},expression:"open"}},[a("InstanceFetcher",{attrs:{url:"api:contract_print_api",post:"",instance_id:t.contract.values.id,model:t.contract_model,data_presenter:t.ContractData},scopedSlots:t._u([{key:"default",fn:function(r){var o=r.data;return[o.values.file_log?a("FileDownloadPreview",{attrs:{file_log:o.get_file_log()}}):t._e()]}}])})],1)}),[],!1,null,null,null);r.a=d.exports},2282:function(t,r,a){"use strict";a(11),a(7),a(12);var o={name:"InvoiceRulePrice",props:{invoice_rule:{required:!0},contract_type:{type:a(329).a,required:!0}},computed:{type:function type(){return this.invoice_rule.values.type},period:function period(){return this.invoice_rule.values.period},currency_symbol:function currency_symbol(){return this.contract_type.currency_symbol}}},c=a(3),i=Object(c.a)(o,(function(){var t=this,r=t.$createElement;return(t._self._c||r)("span",["month"===t.type?["term"===t.period?[t._v("\n      "+t._s(t.invoice_rule.values.month_price)+" "+t._s(t.currency_symbol)+"/"+t._s(t.$gettext("месяц"))+" "+t._s(t.$gettext("при оплате за семестр"))+"\n    ")]:"all"===t.period?[t._v("\n      "+t._s(t.invoice_rule.values.month_price)+" "+t._s(t.currency_symbol)+"/"+t._s(t.$gettext("месяц"))+" "+t._s(t.$gettext("при оплате за год"))+"\n    ")]:[t._v("\n      "+t._s(t.invoice_rule.values.month_price)+" "+t._s(t.currency_symbol)+"/"+t._s(t.$gettext("месяц"))+"\n    ")]]:"hour"===t.type?[t._v("\n    "+t._s(t.invoice_rule.values.hour_price)+" "+t._s(t.currency_symbol)+"/"+t._s(t.$gettext("час"))+"\n  ")]:"term"===t.type?[t._v("\n    "+t._s(t.invoice_rule.values.total_price)+" "+t._s(t.currency_symbol)+"/"+t._s(t.$gettext("семестр"))+"\n  ")]:"total"===t.type||"total_course"===t.type?[t._v("\n    "+t._s(t.invoice_rule.values.total_price)+" "+t._s(t.currency_symbol)+"\n  ")]:t._e()],2)}),[],!1,null,null,null);r.a=i.exports},2294:function(t,r,a){},2434:function(t,r,a){"use strict";a(2294)},2741:function(t,r,a){"use strict";a.r(r);a(25),a(7),a(11),a(12);var o,c,i,l,u=a(80),_=a(824),d=a(4),p=a.n(d),m=a(5),h=a.n(m),v=a(9),y=a.n(v),b=(a(43),a(23),a(18)),g=a(458),C=a(1712),x=(o=function(){function SicknessCertificateData(t,r){p()(this,SicknessCertificateData),this.state=r,this.values=t,this.uid="sickness_certificate:".concat(t.id),this.id=t.id}return h()(SicknessCertificateData,[{key:"contracts",get:function get(){var t=this;return(this.values.contracts||[]).map((function(r){return new g.a(t.state.models.contracts[r],t.state)}))}},{key:"processings",get:function get(){var t=this;return(this.values.processings||[]).map((function(r){return new C.a(t.state.models.processings[r],t.state)}))}},{key:"refund",get:function get(){return 0}}]),SicknessCertificateData}(),y()(o.prototype,"contracts",[b.a],Object.getOwnPropertyDescriptor(o.prototype,"contracts"),o.prototype),y()(o.prototype,"processings",[b.a],Object.getOwnPropertyDescriptor(o.prototype,"processings"),o.prototype),y()(o.prototype,"refund",[b.a],Object.getOwnPropertyDescriptor(o.prototype,"refund"),o.prototype),o),k=a(1644),w=a(324),O=a(143),P=a(152),j=(a(65),a(1)),$=(c=function(){function SicknessClassData(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(j.isRequired)(),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(j.isRequired)(),a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(j.isRequired)(),o=arguments.length>3?arguments[3]:void 0;p()(this,SicknessClassData),this.state=t,this.pupil_course=r,this.classes_user=a,this.missed_class=o,this.classes=this.classes_user.get_classes(),this.is_other_classes=this.classes_user.values.to_classes_id}return h()(SicknessClassData,[{key:"processing_hours",get:function get(){return this.is_other_classes?this.classes.duration_academic:this.missed_class?this.missed_class.classes.duration_academic:0}},{key:"hour_price",get:function get(){var t=new g.a(this.state.models.contracts[this.pupil_course.values.contract_id],this.state),r=this.pupil_course.values.course_type,a=t.contract_type.invoice_rules.find((function(t){var a=t.values;return r===a.course_type}));return a?a.values.compensated_hour_price:0}},{key:"refund",get:function get(){return!this.is_missed||this.missed_class||this.is_other_classes?0:this.hour_price*this.classes.duration_academic}},{key:"is_missed",get:function get(){var t=this.classes_user.values.pupil_attendances[0];return t&&"б"===this.classes.state.models.attendances[t].status}}]),SicknessClassData}(),y()(c.prototype,"processing_hours",[b.a],Object.getOwnPropertyDescriptor(c.prototype,"processing_hours"),c.prototype),y()(c.prototype,"hour_price",[b.a],Object.getOwnPropertyDescriptor(c.prototype,"hour_price"),c.prototype),y()(c.prototype,"is_missed",[b.a],Object.getOwnPropertyDescriptor(c.prototype,"is_missed"),c.prototype),c),S=a(40),B={name:"SicknessClassesRow",components:{TableRow:P.a},props:{sickness_class:{type:$,required:!0},table_columns:{required:!0,type:S.a}}},M=a(3),D=Object(M.a)(B,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("TableRow",{attrs:{columns:t.table_columns.columns},scopedSlots:t._u([{key:"subject",fn:function(){return[t._v("\n    "+t._s(t.sickness_class.classes.course.values.simplest_name)+"\n  ")]},proxy:!0},{key:"contract",fn:function(){return[t._v("\n    "+t._s(t.sickness_class.pupil_course.contract.values.contract_number)+"\n  ")]},proxy:!0},{key:"compensation_per_hour",fn:function(){return[t.sickness_class.hour_price?a("span",[t._v(t._s(t._f("money_field")(t.sickness_class.hour_price)))]):t._e()]},proxy:!0},{key:"date",fn:function(){return[t._v("\n    "+t._s(t._f("moment")(t.sickness_class.classes.values.date_of,"L"))+"\n  ")]},proxy:!0},{key:"missed",fn:function(){return[t.sickness_class.is_missed?a("span",[t._v("\n        "+t._s(t.$gettext("Да"))+", "+t._s(t.sickness_class.classes.duration_academic)+" "+t._s(t.$gettext("ч"))+"\n    ")]):a("span",[t._v("\n      "+t._s(t.$gettext("Нет"))+"\n    ")])]},proxy:!0},{key:"working",fn:function(){return[t.sickness_class.missed_class?a("span",[t._v("\n      "+t._s(t.$gettext("Да"))+",\n      "+t._s(t.sickness_class.missed_class.classes.duration_academic)+" "+t._s(t.$gettext("ч"))+"\n    ")]):t.sickness_class.is_other_classes?a("span",[t._v("\n      "+t._s(t.$gettext("Да"))+",\n      "+t._s(t.$gettext("посещение с другой группой"))+"\n    ")]):a("span",[t._v("\n      "+t._s(t.$gettext("Нет"))+"\n    ")])]},proxy:!0},{key:"compensation",fn:function(){return[t.sickness_class.refund?[t._v(t._s(t.sickness_class.refund))]:[t._v("-")]]},proxy:!0}])})}),[],!1,null,null,null).exports,T=(a(28),a(105),a(27)),E=a(205),q=a(1616),R=a(268),L=(i=function(){function PupilCourseFinancesData(t,r){p()(this,PupilCourseFinancesData),this.state=r,this.values=t,this.uid="pupil_course_finances:".concat(t.id),this.id=t.id}return h()(PupilCourseFinancesData,[{key:"contract",get:function get(){var t=this.state.models.contracts[this.values.contract_id];return t&&new g.a(t,this.state)}},{key:"course",get:function get(){var t=this.state.models.courses[this.values.course_id];return t&&new E.a(t,this.state)}},{key:"classes_users",get:function get(){var t=this;return this.values.classes_users.map((function(r){var a=t.state.models.classes_users[r];return a&&new q.a(a,t.state)}))}},{key:"classes",get:function get(){var t=this;return this.classes_users.map((function(r){var a=t.state.models.classes[r.values.classes_id];return a&&new R.a(a,t.state)}))}}]),PupilCourseFinancesData}(),y()(i.prototype,"contract",[b.a],Object.getOwnPropertyDescriptor(i.prototype,"contract"),i.prototype),y()(i.prototype,"course",[b.a],Object.getOwnPropertyDescriptor(i.prototype,"course"),i.prototype),y()(i.prototype,"classes_users",[b.a],Object.getOwnPropertyDescriptor(i.prototype,"classes_users"),i.prototype),y()(i.prototype,"classes",[b.a],Object.getOwnPropertyDescriptor(i.prototype,"classes"),i.prototype),i);var A=(l=function(){function SicknessClassesProtocol(t,r){p()(this,SicknessClassesProtocol),this.sickness_certificate=t,this.sickness_classes=r}return h()(SicknessClassesProtocol,[{key:"missed_hours",get:function get(){var t=0;return this.sickness_classes.forEach((function(r){t+=r.is_missed?r.classes.duration_academic:0})),t}},{key:"processing_hours",get:function get(){var t=0;return this.sickness_classes.forEach((function(r){t+=r.processing_hours})),t}}]),SicknessClassesProtocol}(),y()(l.prototype,"missed_hours",[b.a],Object.getOwnPropertyDescriptor(l.prototype,"missed_hours"),l.prototype),y()(l.prototype,"processing_hours",[b.a],Object.getOwnPropertyDescriptor(l.prototype,"processing_hours"),l.prototype),l);function get_sickness_classes_protocol(t){var r=[],a=Object(T.k)(t.processings.map((function(t){return t.missed_classes})));return a=Object(T.j)(a,(function(t){return t.values.missed_class_time_id})),Object(T.k)(t.contracts.map((function(t){return function get_contract_pupil_courses(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(j.isRequired)(),r=t.state;return t.values.pupil_courses.map((function(t){return new L(r.models.pupil_courses[t],r)}))}(t)}))).forEach((function(o){o.classes_users.forEach((function(c){if(!o.contract.contract_type.values.is_offer){var i=a[c.values.classes_id],l=new $(t.state,o,c,i);r.push(l)}}))})),r=r.sort((function(t,r){return r.classes.moment_begin-t.classes.moment_begin})),new A(t,r)}var I=a(0);var N,Q={name:"SicknessCertificateProtocol",components:{SicknessClassesRow:D,TableHeader:O.a},props:{protocol:{type:A}},data:function data(){return{table_columns:(t=(new S.c).add_columns([new S.b("subject",Object(I.$gettext)("Предмет")),new S.b("contract",Object(I.$gettext)("Договор")),new S.b("compensation_per_hour",Object(I.$gettext)("Компенсация за час")),new S.b("date",Object(I.$gettext)("Дата")),new S.b("missed",Object(I.$gettext)("Пропущено")),new S.b("working",Object(I.$gettext)("Отработка")),new S.b("compensation",Object(I.$gettext)("Компенсация"))]),new S.a("get_sickness_certificates_columns:subcolumns",t))};var t}},H=Object(M.a)(Q,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return t.protocol.sickness_classes.length?a("div",{staticClass:"table-responsive"},[a("table",{staticClass:"table-modern"},[a("thead",[a("TableHeader",{attrs:{table_columns:t.table_columns}})],1),t._v(" "),a("tbody",[t._l(t.protocol.sickness_classes,(function(r){return a("SicknessClassesRow",{key:r.classes.values.id,attrs:{sickness_class:r,table_columns:t.table_columns}})})),t._v(" "),a("tr",{staticClass:"text-subtitle"},[a("td",[t._v(t._s(t.$gettext("Итог")))]),t._v(" "),a("td",{attrs:{colspan:"3"}}),t._v(" "),a("td",[t._v(t._s(t.protocol.missed_hours)+" "+t._s(t.$gettext("ч.")))]),t._v(" "),a("td",[t._v(t._s(t.protocol.processing_hours)+" "+t._s(t.$gettext("ч.")))]),t._v(" "),a("td",[t._v(t._s(t.protocol.sickness_certificate.values.fee))])])],2)])]):a("div",[t._v("\n  "+t._s(t.$gettext("Пропущенных занятий по данной справке не найдено"))+"\n")])}),[],!1,null,null,null).exports,z=a(89),K=a(2110),G={name:"SicknessCertificatesTable",components:{SicknessCertificateProtocol:H,InstanceFetcher:w.a,TableHeader:O.a,TableRow:P.a},props:{sickness_certificates:{type:Array,required:!0,validate:Object(T.a)(x)}},data:function data(){return{table_columns:(t=(new S.c).add_columns([new S.b("chevron",""),new S.b("period",Object(I.$gettext)("Период")),new S.b("organization",Object(I.$gettext)("Организация"))]),new S.a("get_sickness_certificates_columns:columns",t)),expanded_rows:new z.b("table:sickness_certificates:checked"),certificate_schema:[{applied:{schema:JSON.stringify(K.a),orderBy:"date_from"}}],sickness_certificate_model:_.a,SicknessCertificateData:x};var t},methods:{get_protocol:function get_protocol(t){return get_sickness_classes_protocol(t)},set_icon_classes:function set_icon_classes(t){return this.expanded_rows.is_open(t)?"shp_icons-nav-chevron-up text-primary-pressed":"shp_icons-nav-chevron-down text-color-caption"}}},Y=Object(M.a)(G,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",{staticClass:"table-responsive"},[a("table",{staticClass:"table-modern"},[a("thead",[a("TableHeader",{attrs:{table_columns:t.table_columns}})],1),t._v(" "),a("tbody",[t._l(t.sickness_certificates,(function(r){return[a("TableRow",{key:r.id,attrs:{columns:t.table_columns.columns},scopedSlots:t._u([{key:"chevron",fn:function(){return[a("i",{staticClass:"clickable",class:t.set_icon_classes(r.id),on:{click:function(a){return a.stopPropagation(),t.expanded_rows.toggle(r.id)}}})]},proxy:!0},{key:"period",fn:function(){return[t._v("\n            "+t._s(t._f("moment")(r.values.date_from,"LL"))+" -\n            "+t._s(t._f("moment")(r.values.date_till,"LL"))+"\n          ")]},proxy:!0},{key:"organization",fn:function(){return[t._v("\n            "+t._s(r.values.issued_by)+"\n          ")]},proxy:!0}],null,!0)}),t._v(" "),t.expanded_rows.is_open(r.id)?a("tr",{key:r.id+":subtable",staticClass:"table-modern-info"},[a("td"),t._v(" "),a("td",{attrs:{colspan:"100"}},[a("InstanceFetcher",{attrs:{url:"api:sickness_certificate_protocol_api",model:t.sickness_certificate_model,filters:t.certificate_schema,instance_id:r.id}},[a("SicknessCertificateProtocol",{attrs:{protocol:t.get_protocol(r)}})],1)],1)]):t._e()]}))],2)])])}),[],!1,null,null,null).exports,V={name:"ModernHelp",props:{trigger:{type:String,required:!1,default:"hover"},custom_classes:{type:String,required:!1,default:""}},computed:{root_class:function root_class(){return"".concat(this.trigger,"ed-popover")}}},J=Object(M.a)(V,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("popover",{attrs:{trigger:t.trigger,"custom-class":["modern-popover",t.custom_classes].join(" ")},scopedSlots:t._u([{key:"popover",fn:function(){return[a("span",[t._t("default")],2)]},proxy:!0}],null,!0)},[a("div",{staticClass:"flex",class:t.root_class},[a("i",{staticClass:"shp_icons-question_circle text-placeholder-color",attrs:{"data-role":"trigger"}})])])}),[],!1,null,null,null).exports,U={name:"SicknessCertificatesPanelTitle",components:{ModernHelp:J},props:{is_show_help:{type:Boolean,required:!1,default:!0}}},X={name:"SicknessCertificatesRoot",components:{SicknessCertificatesPanelTitle:Object(M.a)(U,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",{staticClass:"h4 m-none flex flex-vertical-center gap-standart"},[a("span",[t._v("\n    "+t._s(t.$gettext("Справки по болезням"))+"\n  ")]),t._v(" "),t.is_show_help?a("ModernHelp",{attrs:{custom_classes:"popover-fixed-width"}},[t._v("\n    "+t._s(t.$gettext("Принесите справку по болезни, мы назначим дополнительные занятия или сделаем перерасчет."))+"\n  ")]):t._e()],1)}),[],!1,null,null,null).exports,SicknessCertificatesTable:Y,ListFetcher:u.a,ModernCollapsiblePanel:k.a},props:{contracts:{type:Array,required:!0,validate:Object(T.a)(g.a)}},data:function data(){return{sickness_certificate_model:_.a,SicknessCertificateData:x}},computed:{is_money_back_contracts:function is_money_back_contracts(){return this.contracts.some((function(t){return t.contract_type.invoice_rules.some((function(t){return t.values.compensated_hour_price>0}))}))}}},W=Object(M.a)(X,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("ModernCollapsiblePanel",{staticClass:"resizable-padding",scopedSlots:t._u([{key:"title",fn:function(){return[a("SicknessCertificatesPanelTitle",{attrs:{is_show_help:t.is_money_back_contracts}})]},proxy:!0}])},[t._v(" "),a("ListFetcher",{attrs:{url:"api:sickness_certificate_list_api",model:t.sickness_certificate_model,data_presenter:t.SicknessCertificateData},scopedSlots:t._u([{key:"default",fn:function(r){var o=r.data;return[o.length?a("SicknessCertificatesTable",{attrs:{sickness_certificates:o}}):t._e()]}},{key:"empty_list",fn:function(){return[a("div",{staticClass:"text-color-caption"},[t._v("\n        "+t._s(t.$gettext("У вас пока нет оформленных справок"))+"\n      ")])]},proxy:!0}])})],1)}),[],!1,null,null,null).exports,Z=a(44),tt={name:"BankAccountInfo",props:{bank_account:{type:a(1161).a,required:!0}}},et={name:"ClientContractCardRequisites",components:{BankAccountInfo:Object(M.a)(tt,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",[a("div",{staticClass:"text-subtitle mb-xs"},[t._v("\n    "+t._s(t.$gettext("Банковские реквизиты:"))+"\n  ")]),t._v(" "),a("div",{staticClass:"text-color-caption"},[t._v("\n    "+t._s(t.$gettext("Банк:"))+"\n    "+t._s(t.bank_account.values.bank_name)+"\n  ")]),t._v(" "),a("div",{staticClass:"text-color-caption"},[t._v("\n    "+t._s(t.$gettext("Р/c:"))+"\n    "+t._s(t.bank_account.values.settlement_account_num)+"\n  ")]),t._v(" "),a("div",{staticClass:"text-color-caption"},[t._v("\n    "+t._s(t.$gettext("К/c:"))+"\n    "+t._s(t.bank_account.values.correspondent_account)+"\n  ")]),t._v(" "),a("div",{staticClass:"text-color-caption"},[t._v("\n    "+t._s(t.$gettext("БИК:"))+"\n    "+t._s(t.bank_account.values.BIK)+"\n  ")])])}),[],!1,null,null,null).exports},props:{contract:{required:!0,type:g.a}},data:function data(){var t=this.$store.state.models.schools[this.contract.values.official_school_id];return{show:!1,school:t&&new Z.a(t,this.$store.state)}},computed:{bank_account:function bank_account(){return this.contract.contract_type.bank_account},requisites:function requisites(){return this.school.values.requisites}}},nt=Object(M.a)(et,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",{staticClass:"flex-column flex-vertical-start flex-space-between"},[a("div",{staticClass:"flex-column"},[a("div",{staticClass:"h4 uppercase mt-none mb-md"},[t._v("\n      "+t._s(t.$gettext("Реквизиты"))+"\n    ")]),t._v(" "),t.school?a("div",{staticClass:"mb-md"},[a("div",{staticClass:"text-subtitle mb-xs"},[t._v(t._s(t.school.values.short_name))]),t._v(" "),a("div",[t._v(t._s(t.school.values.legal_address.collect_address))]),t._v(" "),a("div",[t._v("\n        "+t._s(t.$gettext("ИНН"))+" "+t._s(t.requisites.INN)+";\n        "+t._s(t.$gettext("КПП"))+" "+t._s(t.requisites.KPP)+"\n      ")]),t._v(" "),a("div",[t._v(t._s(t.$gettext("ОГРН"))+" "+t._s(t.requisites.OGRN))]),t._v(" "),t.school.telephone?a("div",[t._v(t._s(t.$gettext("Тел."))+" "+t._s(t.school.telephone.values.number))]):t._e(),t._v(" "),a("div",[t._v(t._s(t.$gettext("E-mail:"))+" "+t._s(t.school.values.email))])]):t._e(),t._v(" "),t.bank_account?a("BankAccountInfo",{attrs:{bank_account:t.bank_account}}):t._e()],1),t._v(" "),a("div",{staticClass:"full-width"},[a("button",{staticClass:"btn-modern-link no-padding pull-right",on:{click:function(r){return t.$emit("close")}}},[t._v("\n      "+t._s(t.$gettext("Закрыть"))+"\n    ")])])])}),[],!1,null,null,null).exports,rt=a(834),at=a(2282),st=a(1159),ot={name:"InvoiceRuleUsageDetail",components:{InvoiceRulePrice:at.a},props:{invoice_rule_usage:{type:[rt.b,st.a],required:!1},show_period:{type:Boolean,default:!0},contract:{type:g.a,required:!0}}},ct={name:"ClientContractCardMainInfo",components:{InvoiceRuleUsageDetail:Object(M.a)(ot,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",[a("div",{staticClass:"text-subtitle text-color-caption"},[t._t("label",(function(){return[t._v("\n      "+t._s(t.invoice_rule_usage.course_type_display)+"\n    ")]}))],2),t._v(" "),a("InvoiceRulePrice",{attrs:{invoice_rule:t.invoice_rule_usage,contract_type:t.contract.contract_type}})],1)}),[],!1,null,null,null).exports},props:{contract:{required:!0,type:g.a}}},it=Object(M.a)(ct,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",[t.contract.base_rule_router.current?a("InvoiceRuleUsageDetail",{staticClass:"mb-md",attrs:{invoice_rule_usage:t.contract.base_rule_router.current,contract:t.contract}}):t._e(),t._v(" "),t._l(t.contract.contract_type.non_zero_rules,(function(r){return a("InvoiceRuleUsageDetail",{key:r.values.id,staticClass:"mb-md",attrs:{invoice_rule_usage:r,contract:t.contract}})})),t._v(" "),t.contract.base_rule_router.next?a("InvoiceRuleUsageDetail",{staticClass:"mb-md",attrs:{invoice_rule_usage:t.contract.base_rule_router.next,contract:t.contract},scopedSlots:t._u([{key:"label",fn:function(){return[t._v("\n      "+t._s(t.$gettext("стоимость базовых курсов с"))+"\n      "+t._s(t._f("moment")(t.contract.base_rule_router.next.moment_from,"L"))+"\n    ")]},proxy:!0}],null,!1,1962574997)}):t._e(),t._v(" "),t.contract.is_valid_status?a("div",{staticClass:"flex-column mb-md"},[a("span",{staticClass:"text-subtitle text-color-caption"},[t._v("\n      "+t._s(t.$gettext("Текущая сумма к оплате"))+"\n    ")]),t._v(" "),a("span",[t._v("\n      "+t._s(t._f("money_field")(-t.contract.values.balance))+"\n      "+t._s(t.contract.contract_type.currency_symbol)+"\n    ")])]):t._e()],2)}),[],!1,null,null,null).exports,lt={name:"ClientContractCardTitle",props:{contract:{required:!0,type:g.a}}},ut=Object(M.a)(lt,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",[a("div",{staticClass:"flex flex-space-between flex-vertical-center flex-wrap mb-xs"},[a("h4",{staticClass:"m-none break_words"},[t._v("\n      "+t._s(t.contract.values.contract_number)+"\n    ")]),t._v(" "),a("span",{class:["modern-label","modern-label-"+t.contract.modern_status_label_color]},[t._v("\n      "+t._s(t.contract.status)+"\n    ")])]),t._v(" "),a("div",[t._v("\n    "+t._s(t.$gettext("с"))+" "+t._s(t._f("moment")(t.contract.values.date_from,"L"))+"\n    "+t._s(t.$gettext("по"))+" "+t._s(t._f("moment")(t.contract.values.date_to,"L"))+"\n  ")])])}),[],!1,null,null,null).exports,_t=a(39),dt=a(59),pt=a(21),ft=a(22),mt=a(233),ht=a(1160),vt=a(63),yt=a(155),bt={name:"ClientContractCardTariff",components:{ModernHelp:J,AlertError:vt.a},props:{contract:{required:!0,type:g.a}},data:function data(){var t=new _t.a("fake_form",[]);if(this.contract.base_rule_router.planned){var r,a=(null===(r=this.contract.base_rule_router.planned.possible_tariffs)||void 0===r?void 0:r.map((function(t){return[t.id,t.payment_period_text,t.tariff]})))||[],o=[new yt.a("tariffs","").choices(a).default_template().default_selected_template()];t=new _t.a("tariffs_list",o)}return{form:t,is_payments_type_editable:!1,invoice_decorator_id:null}},methods:{change_invoice_rule:function change_invoice_rule(){var t=this;if(this.invoice_decorator_id){var r=new ht.a(this.$store.state.models.invoice_decorators[this.invoice_decorator_id],this.$store.state);new pt.a(ft.b["api:contract_change_tariff_api"](this.contract.id),this.form.uid).on_before(pt.c.hide_errors(this.form.uid)).on_error(pt.c.show_errors(this.form.uid)).single().on_success(pt.c.update_instance(mt.a)).on_success((function(){return t.$emit("contract_updated",t.contract)})).execute(this.$store,{decorator:r.values.id})}},close_tariff_changer:function close_tariff_changer(){new dt.b(this.form.uid).hide_error(this.$store),this.is_payments_type_editable=!1,this.invoice_decorator_id=null}}},gt={name:"ClientContractCard",components:{ClientContractCardTariff:Object(M.a)(bt,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",[a("span",{staticClass:"text-subtitle text-color-caption"},[t._v("\n    "+t._s(t.$gettext("Формат оплаты"))+"\n  ")]),t._v(" "),t.is_payments_type_editable?a("div",{staticClass:"flex flex-wrap gap-sm"},[a("FormulateInput",t._b({staticClass:"flex-grow-1",staticStyle:{"min-width":"100px","max-width":"250px"},attrs:{gettext:"Формат",placeholder:t.$gettext("Формат")},model:{value:t.invoice_decorator_id,callback:function(r){t.invoice_decorator_id=r},expression:"invoice_decorator_id"}},"FormulateInput",t.form.get_props("tariffs"),!1)),t._v(" "),a("div",{staticClass:"flex gap-sm flex-grow-1"},[a("button",{staticClass:"btn-modern-info",on:{click:t.change_invoice_rule}},[a("i",{staticClass:"shp_icons-modern-check"})]),t._v(" "),a("button",{staticClass:"btn-modern-default",on:{click:t.close_tariff_changer}},[a("i",{staticClass:"shp_icons-modern-close"})])])],1):a("div",{staticClass:"flex flex-vertical-center flex-space-between"},[a("div",{staticClass:"flex flex-vertical-center gap-sm"},[a("div",[t._v(t._s(t.contract.base_rule_router.current.payment_period_text))]),t._v(" "),a("ModernHelp",{attrs:{custom_classes:"popover-fixed-width"}},[t._v("\n        "+t._s(t.$gettext("Формат оплаты можно сменить в начале учебного года или семестра в течение месяца до проведения платежа"))+"\n      ")])],1),t._v(" "),t.contract.is_can_change_base_tariff?a("button",{staticClass:"btn-modern-link no-padding",on:{click:function(r){t.is_payments_type_editable=!0}}},[t._v("\n      "+t._s(t.$gettext("Изменить"))+"\n    ")]):t._e()]),t._v(" "),a("AlertError",{attrs:{uid:t.form.uid}})],1)}),[],!1,null,null,null).exports,ClientContractCardRequisites:nt,ClientContractCardMainInfo:it,ClientContractCardTitle:ut},props:{contract:{required:!0,type:g.a}},data:function data(){return{show_requisites:!1}}},Ct=Object(M.a)(gt,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return t.show_requisites?a("div",{staticClass:"modern-placement modern-placement-sm modern-placement-primary-subpanel-dark modern-placement-bgc-primary-subpanel-soft"},[a("ClientContractCardRequisites",{staticClass:"full-height",attrs:{contract:t.contract},on:{close:function(r){t.show_requisites=!1}}})],1):a("div",{staticClass:"modern-placement modern-placement-sm modern-placement-primary-subpanel-dark"},[a("div",{staticClass:"flex-column flex-space-between full-height"},[a("div",[a("ClientContractCardTitle",{staticClass:"mb-md",attrs:{contract:t.contract}}),t._v(" "),a("ClientContractCardMainInfo",{staticClass:"mb-md",attrs:{contract:t.contract}}),t._v(" "),t.contract.is_valid_status&&t.contract.base_rule_router.current?a("ClientContractCardTariff",{staticClass:"mb-md",attrs:{contract:t.contract},on:{contract_updated:function(r){return t.$emit("contract_updated")}}}):t._e()],1),t._v(" "),t.contract.is_valid_status?a("div",{staticClass:"card-buttons-container"},[a("button",{staticClass:"btn-modern-link no-padding",attrs:{disabled:!t.contract.contract_type.values.user_printable},on:{click:function(r){return t.contract.action_operator.set(t.$store,"show_modal")}}},[t._v("\n        "+t._s(t.$gettext("Скачать договор"))+"\n      ")]),t._v(" "),a("div",{staticClass:"card-buttons-container-divider"}),t._v(" "),a("button",{staticClass:"btn-modern-link no-padding",on:{click:function(r){t.show_requisites=!0}}},[t._v("\n        "+t._s(t.$gettext("Посмотреть реквизиты"))+"\n      ")])]):t._e()])])}),[],!1,null,null,null).exports,xt={name:"ClientContracts",components:{ClientContractViewModal:a(2253).a,ClientContractCard:Ct,ModernCollapsiblePanel:k.a},props:{contracts:{type:Array,required:!0,validate:Object(T.a)(g.a)}},data:function data(){return{initial:Boolean(this.contracts.length),tabs:[{name:this.$gettext("Действующие"),value:"actual"},{name:this.$gettext("Расторгнутые"),value:"not_actual"}],actual_tab:"actual"}},computed:{grouped_contracts:function grouped_contracts(){return this.contracts.reduce((function(t,r){return r.is_actual?t.actual.push(r):t.not_actual.push(r),t}),{actual:[],not_actual:[]})}}},kt=Object(M.a)(xt,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("ModernCollapsiblePanel",{staticClass:"resizable-padding",attrs:{initial:t.initial},scopedSlots:t._u([{key:"title",fn:function(){return[a("div",{staticClass:"h4 m-none"},[t._v("\n      "+t._s(t.$gettext("Договоры"))+"\n    ")])]},proxy:!0}])},[t._v(" "),t.contracts.length?a("div",[a("tabs",{attrs:{"custom-nav-class":"modern-nav-tabs-regular mb-md"}},t._l(t.tabs,(function(r){return a("tab",{key:r.value,attrs:{title:r.name}},[a("div",{staticClass:"client-contract__container"},[t._l(t.grouped_contracts[r.value],(function(r){return[a("ClientContractCard",{key:r.id,staticClass:"client-contract__card",attrs:{contract:r},on:{contract_updated:function(r){return t.$emit("contract_updated")}}}),t._v(" "),r.action_info.is("show_modal")?a("ClientContractViewModal",{key:r.id+":modal",attrs:{contract:r}}):t._e()]}))],2)])})),1)],1):a("div",{staticClass:"text-color-caption"},[t._v("\n    "+t._s(t.$gettext("У вас пока нет активных договоров"))+"\n  ")])])}),[],!1,null,null,null).exports,wt=(a(68),a(2109)),Ot=a(779),Pt=(a(33),a(36),a(38),a(26),a(14)),jt=a.n(Pt),$t=a(15),St=a.n($t),Bt=a(8),Mt=a.n(Bt),Dt=a(13),Tt=a.n(Dt),Et=(a(383),a(31),a(979)),qt=a(16);function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=Mt()(t);if(r){var c=Mt()(this).constructor;a=Reflect.construct(o,arguments,c)}else a=o.apply(this,arguments);return St()(this,a)}}var Rt,Lt=(N=function(t){jt()(CashTransferData,t);var r=_createSuper(CashTransferData);function CashTransferData(t,a){var o;return p()(this,CashTransferData),(o=r.call(this)).values=t,o.state=a,o.id=o.values.id,o.uid="transfers:".concat(o.id),o}return h()(CashTransferData,[{key:"amount",get:function get(){return this.values.amount}},{key:"type",get:function get(){return"sickness_certificate_to_balance"===this.values.type?"sickness_certificate":this.values.type}},{key:"icon",get:function get(){return"sickness_certificate"===this.type||"icon-exchange"===this.type?"icon-ambulance":""}},{key:"to_invoice_by_month",get:function get(){return this.state.models.invoices_by_month[this.values.to_invoice_by_month]&&new Et.a(this.state.models.invoices_by_month[this.values.to_invoice_by_month],this.state)}}]),CashTransferData}(qt.c),y()(N.prototype,"amount",[b.a],Object.getOwnPropertyDescriptor(N.prototype,"amount"),N.prototype),y()(N.prototype,"type",[b.a],Object.getOwnPropertyDescriptor(N.prototype,"type"),N.prototype),y()(N.prototype,"icon",[b.a],Object.getOwnPropertyDescriptor(N.prototype,"icon"),N.prototype),y()(N.prototype,"to_invoice_by_month",[b.a],Object.getOwnPropertyDescriptor(N.prototype,"to_invoice_by_month"),N.prototype),N),At=a(19),It=a.n(At),Ft=a(228);function data_pesenters_createSuper(t){var r=function data_pesenters_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=Mt()(t);if(r){var c=Mt()(this).constructor;a=Reflect.construct(o,arguments,c)}else a=o.apply(this,arguments);return St()(this,a)}}function ownKeys(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),a.push.apply(a,o)}return a}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(a),!0).forEach((function(r){Tt()(t,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))}))}return t}function fix_contract_balance_values(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(j.isRequired)(),r=Number(t.amount.toFixed(2));return _objectSpread(_objectSpread({},t),{},{amount:r})}var Nt=(Rt=function(t){jt()(ContractBalanceByMonthData,t);var r=data_pesenters_createSuper(ContractBalanceByMonthData);function ContractBalanceByMonthData(){var t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(j.isRequired)(),o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(j.isRequired)();p()(this,ContractBalanceByMonthData),(t=r.call(this)).values=fix_contract_balance_values(a),t.state=o,t.id=a.id,t.uid="balances:".concat(a.id);var c=t.state.models.contracts[t.values.contract_id];return t.contract=c&&new g.a(c,t.state),t}return h()(ContractBalanceByMonthData,[{key:"currency_symbol",get:function get(){return Ft.c[this.values.currency]}},{key:"from_cash_transfers_sum",get:function get(){var t=0;return this.from_cash_transfers.forEach((function(r){t+=r.values.amount})),t}},{key:"period_from",get:function get(){var t;return this.to_invoices_by_month.forEach((function(r){t=t?Math.min(t,r.values.month):r.values.month})),t&&It()(t)||It()(this.values.month)}},{key:"period_till",get:function get(){var t;return this.to_invoices_by_month.forEach((function(r){t=t?Math.max(t,r.values.month_till):r.values.month_till})),t&&It()(t)||It()(this.values.month_end)}},{key:"period",get:function get(){return this.period_from.month()!==this.period_till.month()?"".concat(this.period_from.format("MMMM")," - ").concat(this.period_till.format("MMMM")):this.period_from.format("MMMM")}},{key:"to_cash_transfers_sum",get:function get(){var t=0;return this.to_cash_transfers.forEach((function(r){t+=r.values.amount})),t}},{key:"from_cash_transfers",get:function get(){var t=this;return(this.values.from_cash_transfers||[]).map((function(r){return new Lt(t.state.models.cash_transfers[r],t.state)}))}},{key:"to_cash_transfers",get:function get(){var t=this;return(this.values.to_cash_transfers||[]).map((function(r){return new Lt(t.state.models.cash_transfers[r],t.state)}))}},{key:"from_balance_transfers",get:function get(){var t=[];return this.from_cash_transfers.forEach((function(r){"balance_to_balance"!==r.type&&"balance_to_balance_by_pupil"!==r.type||t.push(r)})),t}},{key:"to_balance_transfers",get:function get(){var t=[];return this.to_cash_transfers.forEach((function(r){"balance_to_balance"!==r.type&&"balance_to_balance_by_pupil"!==r.type||t.push(r)})),t}},{key:"from_sickness_certificate_transfers",get:function get(){return this.from_cash_transfers.filter((function(t){return"sickness_certificate"===t.type}))}},{key:"to_sickness_certificate_transfers",get:function get(){return this.to_cash_transfers.filter((function(t){return"sickness_certificate"===t.type}))}},{key:"to_payments_transfers",get:function get(){return this.to_cash_transfers.filter((function(t){return"payment_to_balance"===t.type}))}},{key:"to_invoices_by_month",get:function get(){return this.from_cash_transfers.filter((function(t){return t.to_invoice_by_month})).map((function(t){return t.to_invoice_by_month}))}},{key:"corrections",get:function get(){var t=[];return this.from_cash_transfers.forEach((function(r){r.to_invoice_by_month&&r.to_invoice_by_month.corrections.forEach((function(r){t.push(r)}))})),t}},{key:"total_amount",get:function get(){var t=this.from_cash_transfers.find((function(t){return"invoice_to_balance"===t.values.type}));return(t=t?t.values.amount:0)-(this.to_cash_transfers.filter((function(t){return"payment_to_balance"!==t.values.type})).reduce((function(t,r){return t+Number(r.values.amount)}),0)+-this.from_cash_transfers.filter((function(t){return"invoice_to_balance"!==t.values.type})).reduce((function(t,r){return t+Number(r.values.amount)}),0))}}]),ContractBalanceByMonthData}(qt.c),y()(Rt.prototype,"from_cash_transfers_sum",[b.a],Object.getOwnPropertyDescriptor(Rt.prototype,"from_cash_transfers_sum"),Rt.prototype),y()(Rt.prototype,"period_till",[b.a],Object.getOwnPropertyDescriptor(Rt.prototype,"period_till"),Rt.prototype),y()(Rt.prototype,"to_cash_transfers_sum",[b.a],Object.getOwnPropertyDescriptor(Rt.prototype,"to_cash_transfers_sum"),Rt.prototype),y()(Rt.prototype,"from_cash_transfers",[b.a],Object.getOwnPropertyDescriptor(Rt.prototype,"from_cash_transfers"),Rt.prototype),y()(Rt.prototype,"to_cash_transfers",[b.a],Object.getOwnPropertyDescriptor(Rt.prototype,"to_cash_transfers"),Rt.prototype),y()(Rt.prototype,"from_balance_transfers",[b.a],Object.getOwnPropertyDescriptor(Rt.prototype,"from_balance_transfers"),Rt.prototype),y()(Rt.prototype,"to_balance_transfers",[b.a],Object.getOwnPropertyDescriptor(Rt.prototype,"to_balance_transfers"),Rt.prototype),y()(Rt.prototype,"from_sickness_certificate_transfers",[b.a],Object.getOwnPropertyDescriptor(Rt.prototype,"from_sickness_certificate_transfers"),Rt.prototype),y()(Rt.prototype,"to_sickness_certificate_transfers",[b.a],Object.getOwnPropertyDescriptor(Rt.prototype,"to_sickness_certificate_transfers"),Rt.prototype),y()(Rt.prototype,"to_payments_transfers",[b.a],Object.getOwnPropertyDescriptor(Rt.prototype,"to_payments_transfers"),Rt.prototype),y()(Rt.prototype,"to_invoices_by_month",[b.a],Object.getOwnPropertyDescriptor(Rt.prototype,"to_invoices_by_month"),Rt.prototype),y()(Rt.prototype,"corrections",[b.a],Object.getOwnPropertyDescriptor(Rt.prototype,"corrections"),Rt.prototype),y()(Rt.prototype,"total_amount",[b.a],Object.getOwnPropertyDescriptor(Rt.prototype,"total_amount"),Rt.prototype),Rt),Qt=(a(102),a(103),a(130),{yandex:Object(I.$gettext)("ЮKassa"),sberbank:Object(I.$gettext)("ПАО СБЕРБАНК")}),Ht={name:"PaymentModalPanel",props:{acquiring:{required:!0,type:a(1172).a},active:{type:Boolean,default:!1}}},zt=Object(M.a)(Ht,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",{staticClass:"payment_modal__button",class:{payment_modal__active_button:t.active}},["sberbank"===t.acquiring.values.acquiring_type?a("div",[a("img",{staticClass:"inline-block mr-sm",attrs:{height:"30px",src:"/static/acquiring/visa.png"}}),t._v(" "),a("img",{staticClass:"inline-block mr-sm",attrs:{height:"30px",src:"/static/acquiring/mastercard.png"}}),t._v(" "),a("img",{staticClass:"inline-block",attrs:{height:"22px",src:"/static/acquiring/mir.png"}}),t._v(" "),a("div",{staticClass:"mt"},[t._v(t._s(t.$gettext("Банковская карта")))])]):"yandex"===t.acquiring.values.acquiring_type?a("div",[a("img",{staticClass:"inline-block mr-sm",attrs:{height:"30px",src:"/static/acquiring/visa.png"}}),t._v(" "),a("img",{staticClass:"inline-block mr-sm",attrs:{height:"30px",src:"/static/acquiring/mastercard.png"}}),t._v(" "),a("img",{staticClass:"inline-block",attrs:{height:"22px",src:"/static/acquiring/mir.png"}}),t._v(" "),a("div",{staticClass:"mt"},[t._v(t._s(t.$gettext("ЮKassa")))])]):"stripe"===t.acquiring.values.acquiring_type?a("div",[a("img",{attrs:{height:"30px",src:"/static/acquiring/stripe.png"}})]):t._e()])}),[],!1,null,null,null).exports,Kt={name:"PaymentModalInstructions",components:{Collapse:a(77).Collapse},functional:!0},Gt=Object(M.a)(Kt,(function(t,r){var a=r._c;return a("collapse",{model:{value:r.props.show_instructions,callback:function(t){r.$set(r.props,"show_instructions",t)},expression:"props.show_instructions"}},[a("div",{staticClass:"bold mb mt"},[r._v(r._s(r.parent.$gettext("Инструкция по оплате")))]),r._v(" "),a("div",{staticClass:"return-info"},[a("span",[r._v("1. "+r._s(r.parent.$gettext("Нажмите на раздел «Финансы» в боковом меню.")))]),r._v(" "),a("img",{staticClass:"inline-block",attrs:{height:"250px",src:"/static/acquiring/acquiring_1.png"}})]),r._v(" "),a("div",{staticClass:"return-info"},[a("span",[r._v("2. "+r._s(r.parent.$gettext('Выберите договор, по которому хотите произвести оплату, нажав "Оплатить" на соответствующей карточке.')))]),r._v(" "),a("img",{staticClass:"inline-block",attrs:{height:"250px",src:"/static/acquiring/acquiring_2.png"}})]),r._v(" "),a("div",{staticClass:"return-info"},[a("span",[r._v("3. "+r._s(r.parent.$gettext('Выберите способ оплаты банковской картой. Укажите оплачиваемую сумму и нажмите "Оплатить". Вы будете перенаправлены на страницу эквайринга Сбербанка.')))]),r._v(" "),a("img",{staticClass:"inline-block",attrs:{height:"250px",src:"/static/acquiring/acquiring_3.png"}})]),r._v(" "),a("div",{staticClass:"return-info"},[a("span",[r._v("4. "+r._s(r.parent.$gettext("Укажите данные Вашей банковской карты и нажмите «Оплатить» (либо используйте оплату с помощью ApplePay/GooglePay)")))]),r._v(" "),a("img",{staticClass:"inline-block",attrs:{height:"400px",src:"/static/acquiring/acquiring_4.png"}})]),r._v(" "),a("div",{staticClass:"return-info"},[a("span",[r._v("5. "+r._s(r.parent.$gettext("Подтвердите проведение платежа.")))])])])}),[],!0,null,null,null).exports,Yt=a(127),Vt=a(473),Jt=a(24);function PaymentModalvue_type_script_lang_js_ownKeys(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),a.push.apply(a,o)}return a}function PaymentModalvue_type_script_lang_js_objectSpread(t){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?PaymentModalvue_type_script_lang_js_ownKeys(Object(a),!0).forEach((function(r){Tt()(t,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):PaymentModalvue_type_script_lang_js_ownKeys(Object(a)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))}))}return t}var Ut,Xt={name:"PaymentModal",components:{ModernShpModal:Yt.a,PaymentModalInstructions:Gt,PaymentModalPanel:zt,AlertError:vt.a,ShpInputGroup:Vt.a},props:{balances:{type:Array,required:!0,validate:Object(T.a)(Nt)},contract:{type:g.a,required:!0},is_open:{type:Boolean,required:!0},discount:{type:Number,required:!1,default:0}},data:function data(){var t=function get_payment_form(){return new _t.a("payment_form",[new Jt.a("amount","").number().add_props({min:0,validation:"min:0","validation-messages":{min:Object(I.$gettext)("Должно быть больше или равно 0")}})])}(),r=this.contract.get_acquirings(),a=this.$store.state.models.schools[this.contract.values.official_school_id],o=a&&new Z.a(a,this.$store.state);return{form:t,amount:-this.get_total_amount(),is_modal_open:!1,payment_type:!r.length||r[0].school_acquirings.includes("sberbank")?"sberbank":r[0].acquiring_type,PAYMENT_TYPE_NAMES:Qt,acquirings:r,school:o,show_instructions:!1,active_acquring_id:null}},computed:{total_amount:function total_amount(){return this.get_total_amount()},payment_periods:function payment_periods(){var t=this,r=[];return this.balances.forEach((function(a){r.push(t.$moment(a.values.month).format("MMMM YYYY"))})),r.join(", ")},model:function model(){return{amount:-this.total_amount,balances:this.balances.map((function(t){return t.id})),options:{indices:!1}}}},watch:{is_open:function is_open(t){this.is_modal_open=t}},created:function created(){this.is_modal_open=this.is_open},methods:{get_total_amount:function get_total_amount(){return this.balances.reduce((function(t,r){return t+=r.values.amount}),0)+this.discount},set_payment_type:function set_payment_type(t){this.payment_type=t.values.acquiring_type,this.active_acquring_id=t.values.id},create_order:function create_order(){var t=this,r=this.acquirings.find((function(r){return r.values.acquiring_type===t.payment_type}));this.model.acquiring=r.values.id,new pt.a(ft.b["api:payment_order_create_api"](),"payment_order").on_success((function(r,a){var o=a.data.form_url;if(!o){var c={name:"client_payment_order_pay",params:{order_id:a.data.id}};o=t.$router.resolve(c).href}a.data.proxy_url&&(o="".concat(a.data.proxy_url,"?next=").concat(encodeURIComponent(o))),window.location.assign(o)})).resolve_errors(this,this.form.uid).execute(this.$store,PaymentModalvue_type_script_lang_js_objectSpread(PaymentModalvue_type_script_lang_js_objectSpread({},this.model),{},{amount:this.amount}))},toggle_instructions:function toggle_instructions(){this.show_instructions=!this.show_instructions}}},Wt=(a(2434),Object(M.a)(Xt,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("ModernShpModal",{attrs:{size:"xl",gettext:"Оплата по договору",title:t.$gettext("Оплата по договору"),footer:!1},on:{hide:function(r){return t.$emit("update:is_open",!1)}},model:{value:t.is_modal_open,callback:function(r){t.is_modal_open=r},expression:"is_modal_open"}},[a("div",[a("alert-error",{attrs:{uid:t.form.uid}}),t._v(" "),a("div",{staticClass:"mb"},[a("span",{staticClass:"h4"},[t._v(t._s(t.$gettext("Договор Оферта"))+"\n        "),a("strong",[t._v(t._s(t.contract.values.contract_number))]),t._v(".\n        "+t._s(t.$gettext("Cчёт за"))+"\n        "+t._s(t.payment_periods)+"\n      ")])]),t._v(" "),a("div",{staticClass:"mb-lg"},[t._v("\n      "+t._s(t.$gettext("Рекомендованная сумма к оплате:"))+"\n      "+t._s(-t.total_amount)+" "+t._s(t.contract.contract_type.currency_symbol)+"\n    ")]),t._v(" "),a("div",{staticClass:"flex flex-wrap inline-flex",staticStyle:{gap:"16px"}},t._l(t.acquirings,(function(r){return a("payment-modal-panel",{key:r.uid,staticClass:"mb",attrs:{acquiring:r,active:r.values.id===t.active_acquring_id},nativeOn:{click:function(a){return t.set_payment_type(r)}}})})),1),t._v(" "),a("FormulateForm",{attrs:{name:t.form.uid,"keep-model-data":""},on:{submit:t.create_order}},[a("div",{staticClass:"m-b-sm row"},[a("div",{staticClass:"col-md-3 flex flex-vertical-center"},[a("ShpInputGroup",{staticStyle:{"min-width":"250px"},attrs:{gettext:"Сумма платежа",subtitle:t.$gettext("Сумма платежа")}},[a("FormulateInput",t._b({model:{value:t.amount,callback:function(r){t.amount=r},expression:"amount"}},"FormulateInput",t.form.get_props("amount"),!1)),t._v(" "),a("div",{staticClass:"modern-input-group__addon flex-self-start",attrs:{slot:"append_item"},slot:"append_item"},[t._v("\n              "+t._s(t.contract.contract_type.currency_symbol)+"\n            ")])],1)],1)]),t._v(" "),a("div",{staticClass:"m-b-xl"},[a("button",{staticClass:"btn btn-primary"},[t._v(t._s(t.$gettext("Оплатить")))])])]),t._v(" "),a("div",{staticClass:"mb small"},[t._v("\n      "+t._s(t.$gettext("Для оплаты (ввода реквизитов Вашей карты) Вы будете перенаправлены на платежный шлюз "+t.PAYMENT_TYPE_NAMES[t.payment_type]+".\n      Соединение с платежным шлюзом и передача информации осуществляется в защищенном режиме с использованием\n      протокола шифрования SSL. Конфиденциальность сообщаемой персональной информации обеспечивается "+t.PAYMENT_TYPE_NAMES[t.payment_type]+".\n      Введенная информация не будет предоставлена третьим лицам за исключением случаев, предусмотренных\n      законодательством РФ. "))+"\n    ")]),t._v(" "),a("div",{staticClass:"small mb"},[t._v("\n      "+t._s(t.$gettext("Срок возврата денежных средств за неоказанную услугу составляет 30 рабочих дней. Возврат\n      переведенных средств, производится на Ваш банковский счет в течение 10—30 рабочих дней (срок зависит от Банка,\n      который выдал Вашу банковскую карту). Для осуществления возврата денежных средств, необходимо направить письмо\n      на mshp@informatics.ru или осуществить запрос возврата по телефону +7(495)150-64-32 "))+"\n      "),"sberbank"===t.payment_type?[a("a",{on:{click:t.toggle_instructions}},[t._v(t._s(t.$gettext("Условия и инструкция по оплате")))]),t._v(" "),a("payment-modal-instructions",{attrs:{show_instructions:t.show_instructions}})]:t._e()],2),t._v(" "),t.school&&t.school.telephone?a("div",{staticClass:"small mb"},[t._v("\n      "+t._s(t.$gettext("В случае возникновения вопросов по оплате направьте свой запрос по адресу: ")+t.school.values.email+t.$gettext(" или позвоните по телефону: ")+t.school.telephone.values.number)+"\n    ")]):t._e()],1)])}),[],!1,null,null,null).exports),Zt=a(34),te=a.n(Zt),ee=a(20),ne=a.n(ee),re=(a(153),a(45)),ae=(Ut=function(){function Contract_Promocode(t,r){p()(this,Contract_Promocode),this.values=t,this.state=r,this.id=t.id}return h()(Contract_Promocode,[{key:"promo_code",get:function get(){return new se(this.state.models.promo_codes[this.values.promo_code_id],this.state)}}]),Contract_Promocode}(),y()(Ut.prototype,"promo_code",[b.a],Object.getOwnPropertyDescriptor(Ut.prototype,"promo_code"),Ut.prototype),Ut),se=h()((function PromoCode(t,r){p()(this,PromoCode),this.values=t,this.state=r,this.id=t.id})),oe=a(830),ce=function(){function PromoCodeOperator(){p()(this,PromoCodeOperator)}var t;return h()(PromoCodeOperator,[{key:"update",value:(t=te()(ne.a.mark((function _callee(){var t,r,a=arguments;return ne.a.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:Object(j.isRequired)(),r=a.length>1&&void 0!==a[1]?a[1]:Object(j.isRequired)(),o.next=4,new pt.a(ft.b["api:balance_by_month_extended_list_api"](),"update:balances").get().on_success(pt.c.update_multiple(Ot.a)).execute(t,{orderBy:"-month",amount__lt:"0"});case 4:return o.next=6,new pt.a(ft.b["api:contract_promocodes_list_api"](),"update:promocodes").get().on_success(pt.c.update_multiple(oe.a)).execute(t,{contract_id:r.id});case 6:return o.next=8,new pt.a(ft.b["api:contract_client_list_api"](),"update:contracts").get().on_success(pt.c.update_multiple(mt.a)).execute(t,{orderBy:"-date_till"});case 8:case"end":return o.stop()}}),_callee)}))),function update(){return t.apply(this,arguments)})}]),PromoCodeOperator}(),ie=a(1154);function PromocodeSettervue_type_script_lang_js_ownKeys(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),a.push.apply(a,o)}return a}var le={name:"PromocodeSetter",components:{ShpInputGroup:Vt.a},props:{contract:{type:g.a,required:!0},disabled:{type:Boolean,required:!1,default:!1}},data:function data(){var t=[new ie.a("code","").placeholder(Object(I.$gettext)("Промокод"))];return{form:new _t.a("promocode_setter",t),model:{code:""},active:!1}},computed:{contract_promocode:function contract_promocode(){var t=this,r=this.$store.state.models.contract_promocodes&&Object.values(this.$store.state.models.contract_promocodes).find((function(r){return r.contract_id===t.contract.id}));return r&&new ae(r,this.$store.state)},promocode:{get:function get(){var t;return(null===(t=this.contract_promocode)||void 0===t?void 0:t.promo_code.values.code)||this.model.code},set:function set(t){this.model.code=t}},error:function error(){return this.$store.state.errors.messages[this.form.uid]},promocode_not_applied:function promocode_not_applied(){return this.contract_promocode&&!this.contract_promocode.values.applied},promocode_applied:function promocode_applied(){return this.contract_promocode&&this.contract_promocode.values.applied},input_disabled:function input_disabled(){return this.disabled||this.promocode_not_applied||this.promocode_applied}},created:function created(){(new ce).update(this.$store,this.contract)},methods:{apply_promocode:function apply_promocode(){var t,r=this;new pt.a(ft.b["api:contract_promocode_create_api"](),this.form.uid).on_before(pt.c.hide_errors(this.form.uid)).on_error(pt.c.show_errors(this.form.uid)).on_success((t=te()(ne.a.mark((function _callee(t,a){return ne.a.wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(new ce).update(r.$store,r.contract);case 2:return t.next=4,r.$emit("set_discount",{amount:a.data.promo_code.amount,contract_id:r.contract.id});case 4:case"end":return t.stop()}}),_callee)}))),function(r,a){return t.apply(this,arguments)})).execute(this.$store,function PromocodeSettervue_type_script_lang_js_objectSpread(t){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?PromocodeSettervue_type_script_lang_js_ownKeys(Object(a),!0).forEach((function(r){Tt()(t,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):PromocodeSettervue_type_script_lang_js_ownKeys(Object(a)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))}))}return t}({contract:this.contract.id},this.model))},delete_promocode:function delete_promocode(){var t=this;new pt.a(ft.b["api:contract_promocode_delete_api"](this.contract_promocode.id),this.form.uid).on_before(pt.c.hide_errors(this.form.uid)).on_error(pt.c.show_errors(this.form.uid)).on_success(te()(ne.a.mark((function _callee2(){return ne.a.wrap((function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return new re.a([t.contract_promocode.id],t.$vuex_models.contract_promocode_model).force().collect(t.$store),r.next=3,(new ce).update(t.$store,t.contract);case 3:t.model.code="",t.$emit("set_discount",{amount:0,contract_id:t.contract.id});case 5:case"end":return r.stop()}}),_callee2)})))).execute(this.$store,{})}},watch:{contract_promocode:function contract_promocode(t){t&&this.$emit("set_discount",{amount:t.promo_code.values.amount,contract_id:this.contract.id})}}},ue=Object(M.a)(le,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return t.active||t.contract_promocode?a("div",[a("div",{staticClass:"flex flex-space-between mb-sm"},[a("span",{staticClass:"text-caption text-color-caption"},[t._v("\n      "+t._s(t.$gettext("Скидка"))+"\n    ")]),t._v(" "),t.contract_promocode?a("span",{staticClass:"text-caption text-error"},[t._v("\n      - "+t._s(t.contract_promocode.promo_code.values.amount)+" "+t._s(t.contract.contract_type.currency_symbol)+"\n    ")]):a("span",{staticClass:"text-caption text-color-caption"},[t._v("0")])]),t._v(" "),a("ShpInputGroup",{scopedSlots:t._u([{key:"append_item",fn:function(){return[t.contract_promocode?t._e():a("button",{staticClass:"btn-modern-default",attrs:{disabled:t.disabled},on:{click:t.apply_promocode}},[t._v("\n        "+t._s(t.$gettext("Применить"))+"\n      ")]),t._v(" "),t.promocode_applied?a("div",{staticClass:"modern-input-group__addon",attrs:{disabled:""}},[t._v("\n        "+t._s(t.$gettext("Подтвержден"))+"\n      ")]):t._e(),t._v(" "),t.promocode_not_applied?a("button",{staticClass:"btn-modern-default",on:{click:t.delete_promocode}},[t._v("\n        "+t._s(t.$gettext("Удалить"))+"\n      ")]):t._e()]},proxy:!0},{key:"caption",fn:function(){return[a("div",{staticClass:"mt-xs",staticStyle:{"min-height":"16px"}},[t.error?a("div",{staticClass:"flex flex-vertical-center gap-xs text-caption text-error"},[a("i",{staticClass:"shp_icons-information-circle shp_icons-md"}),t._v("\n          "+t._s(t.error)+"\n        ")]):t.contract_promocode?a("div",{staticClass:"flex flex-vertical-center gap-xs text-caption text-success"},[a("i",{staticClass:"shp_icons-check-circle shp_icons-md"}),t._v("\n          "+t._s(t.$gettext("Промокод применен"))+"\n        ")]):t.disabled?a("div",{staticClass:"flex flex-vertical-center gap-xs text-caption text-color-caption"},[t._v("\n          "+t._s(t.$gettext("Промокод можно применить при наличии суммы оплаты"))+"\n        ")]):t._e()])]},proxy:!0}],null,!1,3580832746)},[a("FormulateInput",t._b({staticClass:"flex-grow-1",attrs:{disabled:t.input_disabled},model:{value:t.promocode,callback:function(r){t.promocode=r},expression:"promocode"}},"FormulateInput",t.form.get_props("code"),!1))],1)],1):a("div",[a("button",{staticClass:"btn-modern btn-modern-link",on:{click:function(r){t.active=!0}}},[a("i",{staticClass:"shp_icons-money_ticket_discount_filled mr-sm"}),t._v("\n    "+t._s(t.$gettext("Ввести промокод"))+"\n  ")])])}),[],!1,null,null,null).exports,_e={name:"ContractBalancesTotalPrice",props:{total_amount:{type:Number,required:!0},currency_symbol:{type:String,required:!0},discount:{type:Number,required:!1,default:null},can_pay:{type:Boolean,required:!0}},computed:{is_show_discount:function is_show_discount(){return this.discount&&this.can_pay}}},de=Object(M.a)(_e,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",{staticClass:"flex flex-wrap flex-space-between"},[a("div",{staticClass:"h4"},[t._v("\n    "+t._s(t.$gettext("Итого"))+"\n  ")]),t._v(" "),a("div",[a("span",{staticClass:"h4",class:{"text-disable text-through":t.is_show_discount}},[t._v("\n      "+t._s(t._f("money_field")(t.total_amount))+" "+t._s(t.currency_symbol)+"\n    ")]),t._v(" "),t.is_show_discount?a("span",{staticClass:"h4"},[t._v("\n    "+t._s(t._f("money_field")(t.total_amount-t.discount))+" "+t._s(t.currency_symbol)+"\n  ")]):t._e()])])}),[],!1,null,null,null).exports,pe=(a(41),a(326)),fe=a(463),me={name:"ContractBalancesQrCodeValueProvider",props:{contract:{type:g.a,required:!0},balances:{type:Array,required:!0,validate:Object(T.a)(Nt)},total:{type:Number,required:!0}},computed:{school:function school(){var t=this.contract.values.official_school_id;return new Z.a(this.$store.state.models.schools[t],this.$store.state)},bank_account:function bank_account(){return this.contract.contract_type.bank_account},is_distance_course:function is_distance_course(){return this.contract.contract_type.is_distance_course},pupil:function pupil(){return Object(pe.a)(this.$store.state)},payer:function payer(){return this.contract.representative()||this.pupil},address:function address(){return new fe.a(this.$store.state.models.personal_files[this.pupil.values.personal_file]).values.address},months:function months(){return this.balances.map((function(t){return t.period})).join(",")},contract_and_pupil:function contract_and_pupil(){var t=this.$gettext("по"),r=this.is_distance_course?this.$gettext("счету"):this.$gettext("дог."),a=this.contract.values.contract_number;return"".concat(t," ").concat(r," ").concat(a," ").concat(this.$gettext("за")," ").concat(this.pupil.values.accusative_case)},qr_code_value:function qr_code_value(){return this.total<=0?"":"ST00012|Name=".concat(this.school.values.short_name)+"|PersonalAcc=".concat(this.bank_account.values.settlement_account_num)+"|BankName=".concat(this.bank_account.values.bank_name,"|BIC=").concat(this.bank_account.values.BIK)+"|CorrespAcc=".concat(this.bank_account.values.correspondent_account)+"|PayeeINN=".concat(this.school.values.requisites.INN)+"|LastName=".concat(this.payer.values.surname,"|FirstName=").concat(this.payer.values.name)+"|MiddleName=".concat(this.payer.values.patronymic,"|Purpose=").concat(this.contract_and_pupil)+"|Sum=".concat(this.total,"|Contract=").concat(this.contract.values.contract_number)+"|ChildFio=".concat(this.pupil.values.surname," ").concat(this.pupil.values.name," ").concat(this.pupil.values.patronymic)+"|PayerAddress=".concat(this.address,"|PaymPeriod=").concat(this.months)}}},he=Object(M.a)(me,(function(){var t=this.$createElement;return(this._self._c||t)("div",[this._t("default",null,{value:this.qr_code_value})],2)}),[],!1,null,null,null).exports,ve=1,ye=2,be=4,ge=8;function QR8bitByte(t){this.mode=be,this.data=t}QR8bitByte.prototype={getLength:function(t){return this.data.length},write:function(t){for(var r=0;r<this.data.length;r++)t.put(this.data.charCodeAt(r),8)}};var Ce=QR8bitByte,xe={L:1,M:0,Q:3,H:2};function QRRSBlock(t,r){this.totalCount=t,this.dataCount=r}QRRSBlock.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],QRRSBlock.getRSBlocks=function(t,r){var a=QRRSBlock.getRsBlockTable(t,r);if(null==a)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+r);for(var o=a.length/3,c=new Array,i=0;i<o;i++)for(var l=a[3*i+0],u=a[3*i+1],_=a[3*i+2],d=0;d<l;d++)c.push(new QRRSBlock(u,_));return c},QRRSBlock.getRsBlockTable=function(t,r){switch(r){case xe.L:return QRRSBlock.RS_BLOCK_TABLE[4*(t-1)+0];case xe.M:return QRRSBlock.RS_BLOCK_TABLE[4*(t-1)+1];case xe.Q:return QRRSBlock.RS_BLOCK_TABLE[4*(t-1)+2];case xe.H:return QRRSBlock.RS_BLOCK_TABLE[4*(t-1)+3];default:return}};var ke=QRRSBlock;function QRBitBuffer(){this.buffer=new Array,this.length=0}QRBitBuffer.prototype={get:function(t){var r=Math.floor(t/8);return 1==(this.buffer[r]>>>7-t%8&1)},put:function(t,r){for(var a=0;a<r;a++)this.putBit(1==(t>>>r-a-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var r=Math.floor(this.length/8);this.buffer.length<=r&&this.buffer.push(0),t&&(this.buffer[r]|=128>>>this.length%8),this.length++}};for(var we=QRBitBuffer,Oe={glog:function(t){if(t<1)throw new Error("glog("+t+")");return Oe.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return Oe.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},Pe=0;Pe<8;Pe++)Oe.EXP_TABLE[Pe]=1<<Pe;for(Pe=8;Pe<256;Pe++)Oe.EXP_TABLE[Pe]=Oe.EXP_TABLE[Pe-4]^Oe.EXP_TABLE[Pe-5]^Oe.EXP_TABLE[Pe-6]^Oe.EXP_TABLE[Pe-8];for(Pe=0;Pe<255;Pe++)Oe.LOG_TABLE[Oe.EXP_TABLE[Pe]]=Pe;var je=Oe;function QRPolynomial(t,r){if(null==t.length)throw new Error(t.length+"/"+r);for(var a=0;a<t.length&&0==t[a];)a++;this.num=new Array(t.length-a+r);for(var o=0;o<t.length-a;o++)this.num[o]=t[o+a]}QRPolynomial.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var r=new Array(this.getLength()+t.getLength()-1),a=0;a<this.getLength();a++)for(var o=0;o<t.getLength();o++)r[a+o]^=je.gexp(je.glog(this.get(a))+je.glog(t.get(o)));return new QRPolynomial(r,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var r=je.glog(this.get(0))-je.glog(t.get(0)),a=new Array(this.getLength()),o=0;o<this.getLength();o++)a[o]=this.get(o);for(o=0;o<t.getLength();o++)a[o]^=je.gexp(je.glog(t.get(o))+r);return new QRPolynomial(a,0).mod(t)}};var $e=QRPolynomial,Se=0,Be=1,Me=2,De=3,Te=4,Ee=5,qe=6,Re=7,Le={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var r=t<<10;Le.getBCHDigit(r)-Le.getBCHDigit(Le.G15)>=0;)r^=Le.G15<<Le.getBCHDigit(r)-Le.getBCHDigit(Le.G15);return(t<<10|r)^Le.G15_MASK},getBCHTypeNumber:function(t){for(var r=t<<12;Le.getBCHDigit(r)-Le.getBCHDigit(Le.G18)>=0;)r^=Le.G18<<Le.getBCHDigit(r)-Le.getBCHDigit(Le.G18);return t<<12|r},getBCHDigit:function(t){for(var r=0;0!=t;)r++,t>>>=1;return r},getPatternPosition:function(t){return Le.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,r,a){switch(t){case Se:return(r+a)%2==0;case Be:return r%2==0;case Me:return a%3==0;case De:return(r+a)%3==0;case Te:return(Math.floor(r/2)+Math.floor(a/3))%2==0;case Ee:return r*a%2+r*a%3==0;case qe:return(r*a%2+r*a%3)%2==0;case Re:return(r*a%3+(r+a)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var r=new $e([1],0),a=0;a<t;a++)r=r.multiply(new $e([1,je.gexp(a)],0));return r},getLengthInBits:function(t,r){if(1<=r&&r<10)switch(t){case ve:return 10;case ye:return 9;case be:case ge:return 8;default:throw new Error("mode:"+t)}else if(r<27)switch(t){case ve:return 12;case ye:return 11;case be:return 16;case ge:return 10;default:throw new Error("mode:"+t)}else{if(!(r<41))throw new Error("type:"+r);switch(t){case ve:return 14;case ye:return 13;case be:return 16;case ge:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var r=t.getModuleCount(),a=0,o=0;o<r;o++)for(var c=0;c<r;c++){for(var i=0,l=t.isDark(o,c),u=-1;u<=1;u++)if(!(o+u<0||r<=o+u))for(var _=-1;_<=1;_++)c+_<0||r<=c+_||0==u&&0==_||l==t.isDark(o+u,c+_)&&i++;i>5&&(a+=3+i-5)}for(o=0;o<r-1;o++)for(c=0;c<r-1;c++){var d=0;t.isDark(o,c)&&d++,t.isDark(o+1,c)&&d++,t.isDark(o,c+1)&&d++,t.isDark(o+1,c+1)&&d++,0!=d&&4!=d||(a+=3)}for(o=0;o<r;o++)for(c=0;c<r-6;c++)t.isDark(o,c)&&!t.isDark(o,c+1)&&t.isDark(o,c+2)&&t.isDark(o,c+3)&&t.isDark(o,c+4)&&!t.isDark(o,c+5)&&t.isDark(o,c+6)&&(a+=40);for(c=0;c<r;c++)for(o=0;o<r-6;o++)t.isDark(o,c)&&!t.isDark(o+1,c)&&t.isDark(o+2,c)&&t.isDark(o+3,c)&&t.isDark(o+4,c)&&!t.isDark(o+5,c)&&t.isDark(o+6,c)&&(a+=40);var p=0;for(c=0;c<r;c++)for(o=0;o<r;o++)t.isDark(o,c)&&p++;return a+=10*(Math.abs(100*p/r/r-50)/5)}},Ae=Le;function QRCode(t,r){this.typeNumber=t,this.errorCorrectLevel=r,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var Ie=QRCode.prototype;Ie.addData=function(t){var r=new Ce(t);this.dataList.push(r),this.dataCache=null},Ie.isDark=function(t,r){if(t<0||this.moduleCount<=t||r<0||this.moduleCount<=r)throw new Error(t+","+r);return this.modules[t][r]},Ie.getModuleCount=function(){return this.moduleCount},Ie.make=function(){if(this.typeNumber<1){var t=1;for(t=1;t<40;t++){for(var r=ke.getRSBlocks(t,this.errorCorrectLevel),a=new we,o=0,c=0;c<r.length;c++)o+=r[c].dataCount;for(c=0;c<this.dataList.length;c++){var i=this.dataList[c];a.put(i.mode,4),a.put(i.getLength(),Ae.getLengthInBits(i.mode,t)),i.write(a)}if(a.getLengthInBits()<=8*o)break}this.typeNumber=t}this.makeImpl(!1,this.getBestMaskPattern())},Ie.makeImpl=function(t,r){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var a=0;a<this.moduleCount;a++){this.modules[a]=new Array(this.moduleCount);for(var o=0;o<this.moduleCount;o++)this.modules[a][o]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,r),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=QRCode.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,r)},Ie.setupPositionProbePattern=function(t,r){for(var a=-1;a<=7;a++)if(!(t+a<=-1||this.moduleCount<=t+a))for(var o=-1;o<=7;o++)r+o<=-1||this.moduleCount<=r+o||(this.modules[t+a][r+o]=0<=a&&a<=6&&(0==o||6==o)||0<=o&&o<=6&&(0==a||6==a)||2<=a&&a<=4&&2<=o&&o<=4)},Ie.getBestMaskPattern=function(){for(var t=0,r=0,a=0;a<8;a++){this.makeImpl(!0,a);var o=Ae.getLostPoint(this);(0==a||t>o)&&(t=o,r=a)}return r},Ie.createMovieClip=function(t,r,a){var o=t.createEmptyMovieClip(r,a);this.make();for(var c=0;c<this.modules.length;c++)for(var i=1*c,l=0;l<this.modules[c].length;l++){var u=1*l;this.modules[c][l]&&(o.beginFill(0,100),o.moveTo(u,i),o.lineTo(u+1,i),o.lineTo(u+1,i+1),o.lineTo(u,i+1),o.endFill())}return o},Ie.setupTimingPattern=function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var r=8;r<this.moduleCount-8;r++)null==this.modules[6][r]&&(this.modules[6][r]=r%2==0)},Ie.setupPositionAdjustPattern=function(){for(var t=Ae.getPatternPosition(this.typeNumber),r=0;r<t.length;r++)for(var a=0;a<t.length;a++){var o=t[r],c=t[a];if(null==this.modules[o][c])for(var i=-2;i<=2;i++)for(var l=-2;l<=2;l++)this.modules[o+i][c+l]=-2==i||2==i||-2==l||2==l||0==i&&0==l}},Ie.setupTypeNumber=function(t){for(var r=Ae.getBCHTypeNumber(this.typeNumber),a=0;a<18;a++){var o=!t&&1==(r>>a&1);this.modules[Math.floor(a/3)][a%3+this.moduleCount-8-3]=o}for(a=0;a<18;a++){o=!t&&1==(r>>a&1);this.modules[a%3+this.moduleCount-8-3][Math.floor(a/3)]=o}},Ie.setupTypeInfo=function(t,r){for(var a=this.errorCorrectLevel<<3|r,o=Ae.getBCHTypeInfo(a),c=0;c<15;c++){var i=!t&&1==(o>>c&1);c<6?this.modules[c][8]=i:c<8?this.modules[c+1][8]=i:this.modules[this.moduleCount-15+c][8]=i}for(c=0;c<15;c++){i=!t&&1==(o>>c&1);c<8?this.modules[8][this.moduleCount-c-1]=i:c<9?this.modules[8][15-c-1+1]=i:this.modules[8][15-c-1]=i}this.modules[this.moduleCount-8][8]=!t},Ie.mapData=function(t,r){for(var a=-1,o=this.moduleCount-1,c=7,i=0,l=this.moduleCount-1;l>0;l-=2)for(6==l&&l--;;){for(var u=0;u<2;u++)if(null==this.modules[o][l-u]){var _=!1;i<t.length&&(_=1==(t[i]>>>c&1)),Ae.getMask(r,o,l-u)&&(_=!_),this.modules[o][l-u]=_,-1==--c&&(i++,c=7)}if((o+=a)<0||this.moduleCount<=o){o-=a,a=-a;break}}},QRCode.PAD0=236,QRCode.PAD1=17,QRCode.createData=function(t,r,a){for(var o=ke.getRSBlocks(t,r),c=new we,i=0;i<a.length;i++){var l=a[i];c.put(l.mode,4),c.put(l.getLength(),Ae.getLengthInBits(l.mode,t)),l.write(c)}var u=0;for(i=0;i<o.length;i++)u+=o[i].dataCount;if(c.getLengthInBits()>8*u)throw new Error("code length overflow. ("+c.getLengthInBits()+">"+8*u+")");for(c.getLengthInBits()+4<=8*u&&c.put(0,4);c.getLengthInBits()%8!=0;)c.putBit(!1);for(;!(c.getLengthInBits()>=8*u||(c.put(QRCode.PAD0,8),c.getLengthInBits()>=8*u));)c.put(QRCode.PAD1,8);return QRCode.createBytes(c,o)},QRCode.createBytes=function(t,r){for(var a=0,o=0,c=0,i=new Array(r.length),l=new Array(r.length),u=0;u<r.length;u++){var _=r[u].dataCount,d=r[u].totalCount-_;o=Math.max(o,_),c=Math.max(c,d),i[u]=new Array(_);for(var p=0;p<i[u].length;p++)i[u][p]=255&t.buffer[p+a];a+=_;var m=Ae.getErrorCorrectPolynomial(d),h=new $e(i[u],m.getLength()-1).mod(m);l[u]=new Array(m.getLength()-1);for(p=0;p<l[u].length;p++){var v=p+h.getLength()-l[u].length;l[u][p]=v>=0?h.get(v):0}}var y=0;for(p=0;p<r.length;p++)y+=r[p].totalCount;var b=new Array(y),g=0;for(p=0;p<o;p++)for(u=0;u<r.length;u++)p<i[u].length&&(b[g++]=i[u][p]);for(p=0;p<c;p++)for(u=0;u<r.length;u++)p<l[u].length&&(b[g++]=l[u][p]);return b};var Fe=QRCode;var Ne,Qe={props:{value:{type:String,required:!0,default:""},className:{type:String,default:""},size:{type:[Number,String],default:100,validator:function validator(t){return!0!==isNaN(Number(t))}},level:{type:String,default:"L",validator:function validator(t){return["L","Q","M","H"].indexOf(t)>-1}},background:{type:String,default:"#fff"},foreground:{type:String,default:"#000"},renderAs:{type:String,required:!1,default:"canvas",validator:function validator(t){return["canvas","svg"].indexOf(t)>-1}}},data:function data(){return{numCells:0,fgPath:""}},updated:function updated(){this.render()},mounted:function mounted(){this.render()},methods:{render:function render(){var t=this.value,r=this.size,a=this.level,o=this.background,c=this.foreground,i=this.renderAs,l=r>>>0,u=new Fe(-1,xe[a]);u.addData(function toUTF8String(t){for(var r="",a=0;a<t.length;a++){var o=t.charCodeAt(a);o<128?r+=String.fromCharCode(o):o<2048?(r+=String.fromCharCode(192|o>>6),r+=String.fromCharCode(128|63&o)):o<55296||o>=57344?(r+=String.fromCharCode(224|o>>12),r+=String.fromCharCode(128|o>>6&63),r+=String.fromCharCode(128|63&o)):(a++,o=65536+((1023&o)<<10|1023&t.charCodeAt(a)),r+=String.fromCharCode(240|o>>18),r+=String.fromCharCode(128|o>>12&63),r+=String.fromCharCode(128|o>>6&63),r+=String.fromCharCode(128|63&o))}return r}(t)),u.make();var _=u.modules,d=l/_.length,p=l/_.length,m=window.devicePixelRatio||1;if("svg"===i)this.numCells=_.length,this.fgPath=function generatePath(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=[];return t.forEach((function(t,o){var c=null;t.forEach((function(i,l){if(!i&&null!==c)return a.push("M".concat(c+r," ").concat(o+r,"h").concat(l-c,"v1H").concat(c+r,"z")),void(c=null);if(l!==t.length-1)i&&null===c&&(c=l);else{if(!i)return;null===c?a.push("M".concat(l+r,",").concat(o+r," h1v1H").concat(l+r,"z")):a.push("M".concat(c+r,",").concat(o+r," h").concat(l+1-c,"v1H").concat(c+r,"z"))}}))})),a.join("")}(_);else{var h=this.$refs["qrcode-vue"],v=h.getContext("2d");h.height=h.width=l*m,v.scale(m,m),_.forEach((function(t,r){t.forEach((function(t,a){v.fillStyle=t?c:o;var i=Math.ceil((a+1)*d)-Math.floor(a*d),l=Math.ceil((r+1)*p)-Math.floor(r*p);v.fillRect(Math.round(a*d),Math.round(r*p),i,l)}))}))}}},render:function render(t){var r=this.className,a=this.value,o=this.level,c=this.background,i=this.foreground,l=this.size,u=this.renderAs,_=this.numCells,d=this.fgPath;return t("div",{class:this.class||r,attrs:{value:a,level:o,background:c,foreground:i}},["svg"===u?t("svg",{attrs:{height:l,width:l,shapeRendering:"crispEdges",viewBox:"0 0 ".concat(_," ").concat(_)},style:{width:l+"px",height:l+"px"}},[t("path",{attrs:{fill:c,d:"M0,0 h".concat(_,"v").concat(_,"H0z")}}),t("path",{attrs:{fill:i,d:d}})]):t("canvas",{attrs:{height:l,width:l},style:{width:l+"px",height:l+"px"},ref:"qrcode-vue"},[])])}},He={name:"PaymentQrCodeModal",components:{ModernShpModal:Yt.a,QrcodeVue:Qe},props:{value:{type:String,required:!0},size:{type:[String,Number],required:!1,default:300}},data:function data(){return{open:!0}}},ze={name:"QrCodeManager",components:{QrcodeVue:Qe,QrCodeModal:Object(M.a)(He,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("ModernShpModal",{staticClass:"modal-no-header modal-adaptive modal-same-padding",attrs:{align_center:"",adaptive:"",footer:!1},on:{hide:function(r){return t.$emit("close")}},model:{value:t.open,callback:function(r){t.open=r},expression:"open"}},[a("QrcodeVue",{staticClass:"flex",attrs:{value:t.value,size:t.size}})],1)}),[],!1,null,null,null).exports},props:{value:{type:String,required:!0},with_modal:{type:Boolean,required:!1,default:!1},savable:{type:Boolean,required:!1,default:!1},name:{type:String,required:!1,default:"qr_"+It.a.now()},size:{type:[String,Number],required:!1,default:100}},data:function data(){return{open:!1}},methods:{handle_click:function handle_click(){this.with_modal&&(this.open=!this.open)},save:function save(){var t=this.$refs["qr-code"].$refs["qrcode-vue"].toDataURL("image/png"),r=document.createElement("a");r.download=this.name,r.href=t,r.click()}}},Ke=Object(M.a)(ze,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",[a("div",{staticClass:"flex flex-space-between mb-sm"},[t._t("title",(function(){return[a("h4",{staticClass:"m-none"},[t._v("\n        "+t._s(t.$gettext("QR-код для оплаты"))+"\n      ")])]})),t._v(" "),t.savable?[a("i",{staticClass:"shp_icons-arrow_import clickable",on:{click:t.save}}),t._v(" "),a("QrcodeVue",{ref:"qr-code",attrs:{size:"500",hidden:"",value:t.value}})]:t._e()],2),t._v(" "),a("div",{staticClass:"qr-code-container",class:{"qr-code-zoomable":t.with_modal},on:{click:t.handle_click}},[a("QrcodeVue",{staticClass:"qr-code",attrs:{size:t.size,value:t.value}}),t._v(" "),t.with_modal?a("div",{staticClass:"qr-code-hover",style:{height:t.size+"px",width:t.size+"px"}},[a("i",{staticClass:"shp_icons-search_search_zoom_in_filled shp_icons-3xl text-white"})]):t._e()],1),t._v(" "),t.with_modal?[t.open?a("QrCodeModal",{attrs:{value:t.value},on:{close:function(r){t.open=!1}}}):t._e()]:t._e()],2)}),[],!1,null,null,null).exports,Ge=a(109),Ye=a(247),Ve={name:"ContractBalancesByMonthCard",components:{ShpCheckbox:Ge.a,ContractBalancesQrCodeValueProvider:he,PaymentModal:Wt,PromocodeSetter:ue,QrCodeManager:Ke,ContractBalancesTotalPrice:de,ShpRadio:Ye.a},props:{contracts:{type:Array,required:!0,validate:Object(T.a)(g.a)},balances_by_contracts:{type:Object,required:!0}},data:function data(){return{selected_contract:this.contracts[0],filtered_balances:null,balances_rows:new z.b("balances_by_months").in_memory(),is_payment_open:!1,discount:null}},computed:{selected_balances_ids:function selected_balances_ids(){return this.balances_rows.get_opened_ids()},selected_balances:function selected_balances(){var t=this;return this.filtered_balances.filter((function(r){return t.selected_balances_ids.includes(String(r.id))}))},amounts_by_contract:function amounts_by_contract(){var t=this;return this.contracts.reduce((function(r,a){return r[a.id]=Math.abs((t.balances_by_contracts[a.id]||[]).reduce((function(t,r){return r&&(t+=r.values.amount),t}),0)),r}),{})},total_amount:function total_amount(){return this.selected_balances.reduce((function(t,r){return r&&(t-=r.values.amount),t}),0)},selected_amount:function selected_amount(){return this.amounts_by_contract[this.selected_contract.id]},selected_discount:function selected_discount(){var t;return this.selected_contract.id===(null===(t=this.discount)||void 0===t?void 0:t.contract_id)?this.discount.amount:0},print_link:function print_link(){return{name:"finances_print_receipt",params:{contract_id:this.selected_contract.id},query:{balances:this.selected_balances_ids.join(",")}}}},watch:{selected_contract:function selected_contract(t){this.set_balances(t.id)}},created:function created(){this.set_balances(this.selected_contract.id)},methods:{set_balances:function set_balances(t){this.filtered_balances=(this.balances_by_contracts[t]||[]).filter((function(t){return t.values.amount<0})),this.balances_rows.open_multiple(this.filtered_balances.map((function(t){return t.values.id})))},update_discount:function update_discount(t){this.discount=t,this.set_balances(this.discount.contract_id)}}},Je={name:"ContractBalancesByMonthList",components:{ContractBalancesByMonthCard:Object(M.a)(Ve,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",{staticClass:"contract-balance-card"},[a("h4",{staticClass:"mt-none mb-sm"},[t._v("\n    "+t._s(t.$gettext("Оплата"))+"\n  ")]),t._v(" "),a("div",{staticClass:"flex-column gap-sm"},t._l(t.contracts,(function(r){return a("div",{key:r.id,staticClass:"contract-balance-option",class:{active:r.id===t.selected_contract.id,disabled:1===t.contracts.length},on:{click:function(a){t.selected_contract=r}}},[a("div",{staticClass:"flex flex-space-between flex-vertical-center mb"},[a("div",{staticClass:"h4 m-none"},[t._v("\n          "+t._s(r.values.contract_number)+"\n        ")]),t._v(" "),a("ShpRadio",{attrs:{checked:r.id===t.selected_contract.id,disabled:1===t.contracts.length}})],1),t._v(" "),a("div",{staticClass:"flex flex-space-between flex-vertical-center"},[a("div",{staticClass:"text-overline uppercase"},[t._v("\n          "+t._s(t.$gettext("К оплате"))+"\n        ")]),t._v(" "),a("div",{staticClass:"text-overline uppercase"},[t._v("\n          "+t._s(t._f("money_field")(t.amounts_by_contract[r.id]))+" "+t._s(r.contract_type.currency_symbol)+"\n        ")])])])})),0),t._v(" "),a("div",{staticClass:"modern-divider mt-md mb-md"}),t._v(" "),a("div",{staticClass:"flex-column"},t._l(t.filtered_balances,(function(r){return a("div",{key:r.id,staticClass:"flex flex-wrap flex-space-between"},[a("div",{staticClass:"flex flex-vertical-center gap-sm"},[a("ShpCheckbox",{attrs:{modern:"",checked:t.balances_rows.is_open(r.id)},on:{change:function(a){return t.balances_rows.toggle(r.id)}}}),t._v(" "),a("span",[t._v(t._s(r.period))])],1),t._v(" "),a("span",[t._v(t._s(t._f("money_field")(-r.values.amount))+" "+t._s(t.selected_contract.contract_type.currency_symbol))])])})),0),t._v(" "),a("div",{staticClass:"contract-balance-card__total"},[t.selected_contract.is_actual&&t.selected_contract.contract_type.values.promocode_enabled?a("PromocodeSetter",{staticClass:"mb",attrs:{disabled:!t.selected_balances.length,contract:t.selected_contract},on:{set_discount:t.update_discount}}):t._e(),t._v(" "),a("ContractBalancesTotalPrice",{key:t.total_amount,staticClass:"mb-md",attrs:{can_pay:Boolean(t.total_amount),total_amount:t.total_amount,currency_symbol:t.selected_contract.contract_type.currency_symbol,discount:t.selected_discount}}),t._v(" "),a("div",{staticClass:"flex-column gap-sm"},[t.selected_contract.has_acquiring?a("button",{staticClass:"btn-modern-primary",attrs:{disabled:!t.selected_balances.length},on:{click:function(r){t.is_payment_open=!0}}},[t._v("\n        "+t._s(t.$gettext("Оплатить"))+"\n      ")]):t._e(),t._v(" "),a("RouterLink",{staticClass:"btn-modern-default",attrs:{tag:"button",to:t.print_link,disabled:!t.selected_balances.length}},[t._v("\n        "+t._s(t.$gettext("Скачать квитанцию"))+"\n      ")])],1)],1),t._v(" "),a("div",{staticClass:"modern-divider"}),t._v(" "),a("div",{staticClass:"contract-balance-card__qrcode"},[a("ContractBalancesQrCodeValueProvider",{attrs:{contract:t.selected_contract,total:100*(t.total_amount-t.selected_discount),balances:t.selected_balances},scopedSlots:t._u([{key:"default",fn:function(r){var o=r.value;return[a("QrCodeManager",{staticClass:"full-width",attrs:{with_modal:"",savable:"",value:o,size:180,name:t.selected_contract.values.contract_number}})]}}])})],1),t._v(" "),t.is_payment_open?a("PaymentModal",{attrs:{is_open:t.is_payment_open,contract:t.selected_contract,balances:t.selected_balances,discount:t.selected_discount},on:{"update:is_open":function(r){t.is_payment_open=r}}}):t._e()],1)}),[],!1,null,null,null).exports},props:{balances:{type:Array,required:!0,validate:Object(T.a)(Nt)}},computed:{balances_by_contracts:function balances_by_contracts(){return Object(T.f)(this.balances,(function(t){return t.values.contract_id}))},grouped_contracts:function grouped_contracts(){var t=this,r=this.balances.map((function(t){return t.contract}));return Object(T.l)(r,(function(t){return t.values.id})).reduce((function(r,a){var o;return null!==(o=t.balances_by_contracts[a.id])&&void 0!==o&&o.filter((function(t){return t.values.amount<0})).length?r.unpaid.push(a):r.paid.push(a),r}),{paid:[],unpaid:[]})}}},Ue={name:"ContractBalancesByMonth",components:{ContractBalancesByMonthList:Object(M.a)(Je,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",{staticClass:"flex-column gap-standart"},[t.grouped_contracts.unpaid.length?a("ContractBalancesByMonthCard",{attrs:{contracts:t.grouped_contracts.unpaid,balances_by_contracts:t.balances_by_contracts}}):t._e(),t._v(" "),t._l(t.grouped_contracts.paid,(function(r){return a("div",{key:r.uid,staticClass:"modern-panel"},[a("div",{staticClass:"panel-heading panel-heading-plug flex flex-vertical-center"},[a("h4",[t._v(t._s(r.values.contract_number))]),t._v(" "),a("span",{staticClass:"modern-label modern-label-success ml"},[t._v("\n      "+t._s(t.$gettext("Оплачен"))+"\n    ")])])])}))],2)}),[],!1,null,null,null).exports,ListFetcher:u.a},props:{watch_key:{type:Number,required:!1}},data:function data(){return{balances_filter:[{applied:{orderBy:"-month",schema:JSON.stringify(wt.c)}}],contract_balance_by_month_model:Ot.a,ContractBalanceByMonthData:Nt}}},Xe=Object(M.a)(Ue,(function(){var t=this.$createElement,r=this._self._c||t;return r("ListFetcher",{attrs:{url:"api:balance_by_month_extended_list_api",model:this.contract_balance_by_month_model,data_presenter:this.ContractBalanceByMonthData,filters:this.balances_filter,watch_key:this.watch_key},scopedSlots:this._u([{key:"default",fn:function(t){var a=t.data;return[r("ContractBalancesByMonthList",{attrs:{balances:a}})]}}])})}),[],!1,null,null,null).exports,We=(Ne=function(){function PaymentData(t,r){p()(this,PaymentData),this.state=r,this.values=t,this.uid="payment:".concat(this.values.id),this.id=t.id}return h()(PaymentData,[{key:"currency_symbol",get:function get(){return Ft.c[this.values.currency]}},{key:"date",get:function get(){return new Date(this.values.date)}}]),PaymentData}(),y()(Ne.prototype,"date",[b.a],Object.getOwnPropertyDescriptor(Ne.prototype,"date"),Ne.prototype),Ne),Ze=a(829);var tn={name:"PaymentsTable",components:{TableHeader:O.a,TableRow:P.a},props:{payments:{type:Array,required:!0,validate:Object(T.a)(We)}},data:function data(){return{table_columns:(t=(new S.c).add_columns([new S.b("date",Object(I.$gettext)("Дата платежа")).width("200px"),new S.b("sum",Object(I.$gettext)("Сумма"))]),new S.a("payments:columns",t))};var t}},en={name:"PaymentsList",components:{PaymentsTable:Object(M.a)(tn,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",{staticClass:"table-responsive"},[a("table",{staticClass:"table-modern"},[a("thead",[a("TableHeader",{attrs:{table_columns:t.table_columns}})],1),t._v(" "),a("tbody",t._l(t.payments,(function(r){return a("TableRow",{key:r.uid,attrs:{columns:t.table_columns.columns},scopedSlots:t._u([{key:"date",fn:function(){return[t._v("\n        "+t._s(t._f("moment")(r.date,"LL"))+"\n      ")]},proxy:!0},{key:"sum",fn:function(){return[t._v("\n        "+t._s(r.values.fee)+" "+t._s(r.currency_symbol)+"\n      ")]},proxy:!0}],null,!0)})})),1)])])}),[],!1,null,null,null).exports,ModernCollapsiblePanel:k.a,ListFetcher:u.a},data:function data(){return{PaymentData:We,payment_model:Ze.a,payments_filter:[{applied:{orderBy:"-month"}}]}}},nn=Object(M.a)(en,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("ModernCollapsiblePanel",{staticClass:"resizable-padding",scopedSlots:t._u([{key:"title",fn:function(){return[a("div",{staticClass:"h4 m-none"},[t._v("\n      "+t._s(t.$gettext("История платежей"))+"\n    ")])]},proxy:!0}])},[t._v(" "),a("ListFetcher",{attrs:{url:"api:payment_list_api",limit:"5",use_modern_paginator:"",model:t.payment_model,filters:t.payments_filter,data_presenter:t.PaymentData},scopedSlots:t._u([{key:"default",fn:function(r){var o=r.data;return[o.length?a("PaymentsTable",{attrs:{payments:o}}):t._e()]}},{key:"empty_list",fn:function(){return[a("div",{staticClass:"text-color-caption"},[t._v("\n        "+t._s(t.$gettext("У вас пока нет проведенных платежей"))+"\n      ")])]},proxy:!0}])})],1)}),[],!1,null,null,null).exports,rn=a(329),an={name:"CashTransferField",props:{cash_transfer:{type:Lt,required:!0},contract_type:{type:rn.a,required:!1}},computed:{certificate:function certificate(){return this.cash_transfer.values.from_sickness_certificate},payment:function payment(){return this.cash_transfer.values.from_payment},amount:function amount(){return this.cash_transfer.amount}}},sn=Object(M.a)(an,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("popover",{attrs:{trigger:"hover"},scopedSlots:t._u([{key:"popover",fn:function(){return[a("div",{staticClass:"modern-page"},["sickness_certificate_to_balance"===t.cash_transfer.values.type?[t._v("\n        "+t._s(t.$gettext("Справка с"))+"\n        "+t._s(t._f("moment")(t.certificate.date_from,"L"))+"\n        "+t._s(t.$gettext("по"))+"\n        "+t._s(t._f("moment")(t.certificate.date_till,"L"))+"\n        "),a("br"),t._v("\n        "+t._s(t.$gettext("Коррекция"))+"\n        "+t._s(t.certificate.fee)+"\n        "+t._s(t.contract_type.currency_symbol)+"\n      ")]:"payment_to_balance"===t.cash_transfer.values.type?[t._v("\n        "+t._s(t.$gettext("Платёж"))+"\n        "+t._s(t.payment.number)+"\n        "+t._s(t.$gettext("от"))+"\n        "+t._s(t._f("moment")(t.payment.date,"L"))+"\n        "),a("br"),t._v("\n        "+t._s(t.$gettext("Cумма"))+":\n        "+t._s(t.payment.fee)+"\n        "+t._s(t.contract_type.currency_symbol)+"\n      ")]:t._e()],2)]},proxy:!0}])},[a("span",{staticClass:"text-dashed clickable",attrs:{"data-role":"trigger"}},[t._v("\n    "+t._s(t._f("money_field")(t.amount))+" "+t._s(t.contract_type.currency_symbol)+"\n  ")])])}),[],!1,null,null,null).exports,on={name:"CorrectionField",props:{correction:{required:!0,type:a(1173).a}}},cn=Object(M.a)(on,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("popover",{attrs:{trigger:"hover"},scopedSlots:t._u([{key:"popover",fn:function(){return[a("div",{staticClass:"modern-page"},[t._v("\n      "+t._s(t.$gettext("Коррекция"))+"\n      "+t._s(t.correction.values.fee)+"\n    ")])]},proxy:!0}])},[a("span",{staticClass:"text-dashed clickable",attrs:{"data-role":"trigger"}},[t._v("\n    "+t._s(t._f("money_field")(t.correction.values.fee))+"\n  ")])])}),[],!1,null,null,null).exports,ln=a(106),un=a.n(ln),_n=(a(222),function(){function InvoicePeriodReportData(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(j.isRequired)(),r=arguments.length>1?arguments[1]:void 0;p()(this,InvoicePeriodReportData),this.month=t,this.sub_invoices=r,this.uid="invoice_period_reports:".concat(this.month)}return h()(InvoicePeriodReportData,[{key:"composite_invoices",get:function get(){return this.sub_invoices.filter((function(t){return"hour"!==t.rule.type}))}},{key:"courses_by_month",get:function get(){for(var t=[],r=this.sub_invoices.filter((function(t){return"hour"===t.rule.type})),a=Object(T.f)(r,(function(t){return t.course.simple_name})),o=0,c=Object.entries(a);o<c.length;o++){var i=un()(c[o],2),l=i[0],u=i[1],_=u.reduce((function(t,r){return t+r.classes.hours}),0),d=u.reduce((function(t,r){return t+r.amount}),0);t.push({name:l,hours:_,price:u[0].rule.hour_price,amount:d})}return t}}]),InvoicePeriodReportData}());var dn={name:"SubInvoiceModifiers",props:{modifiers:{required:!0,type:Array},contract_type:{type:rn.a,required:!0}}},pn={name:"InvoicePeriodReport",components:{SubInvoiceModifiers:Object(M.a)(dn,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",t._l(t.modifiers,(function(r){return a("div",{key:r.code,staticClass:"flex-column"},["tariff"===r.type&&"term"===r.period?a("div",[t._v("\n      "+t._s("Цена при оплате за семестр:")+" "+t._s(r.discount_amount)+" "+t._s(t.contract_type.currency_symbol)+"\n    ")]):t._e(),t._v(" "),"tariff"===r.type&&"all"===r.period?a("div",[t._v("\n      "+t._s("Цена при оплате за год:")+" "+t._s(r.discount_amount)+t._s(t.contract_type.currency_symbol)+"\n    ")]):t._e(),t._v(" "),"month_price"===r.type?a("div",[t._v("\n      "+t._s("Спец цена за месяц:")+" "+t._s(r.first_month_price)+t._s(t.contract_type.currency_symbol)+"\n    ")]):t._e(),t._v(" "),"promocode"===r.type?a("div",[t._v("\n      "+t._s("Скидка по промокоду")+" "+t._s(r.code)+": "+t._s(r.amount)+" "+t._s(t.contract_type.currency_symbol)+"\n    ")]):t._e(),t._v(" "),"contract_referral"===r.type?a("div",[t._v("\n      "+t._s("Скидка по реферальному коду")+" "+t._s(r.code)+": "+t._s(r.amount)+" "+t._s(t.contract_type.currency_symbol)+"\n    ")]):t._e()])})),0)}),[],!1,null,null,null).exports},props:{invoice_period_report:{required:!0,type:_n},contract_type:{required:!0,type:rn.a}}},fn={name:"InvoiceByMonthField",components:{InvoicePeriodReport:Object(M.a)(pn,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",[a("b",{staticClass:"text-label"},[t._v(t._s(t.$moment(t.invoice_period_report.month).format("MMMM")))]),t._v(" "),t._l(t.invoice_period_report.composite_invoices,(function(r,o){return a("div",{key:o},["month"===r.rule.type?a("div",[a("ul",{staticClass:"normalized"},[a("li",[t._v("\n          "+t._s(t.$gettext("Цена за базовые курсы"))+":\n          "+t._s(r.rule.month_price)+"\n          "+t._s(t.contract_type.values.currency_symbol)+"\n        ")]),t._v(" "),r.rule.month_price!==r.amount?a("li",[a("SubInvoiceModifiers",{attrs:{modifiers:r.modifiers,contract_type:t.contract_type}}),t._v(" "),a("div",[t._v("\n            "+t._s(t.$gettext("Итого"))+":\n            "+t._s(r.amount)+"\n            "+t._s(t.contract_type.values.currency_symbol)+"\n          ")])],1):t._e()])]):"total"===r.rule.type?a("div",[a("ul",{staticClass:"normalized"},[a("li",[t._v("\n          "+t._s(t.$gettext("Разовая оплата"))+":\n          "+t._s(r.rule.total_price)+"\n          "+t._s(t.contract_type.values.currency_symbol)+"\n        ")]),t._v(" "),r.rule.total_price!==r.amount?a("li",[a("SubInvoiceModifiers",{attrs:{modifiers:r.modifiers,contract_type:t.contract_type}}),t._v(" "),a("div",[t._v("\n            "+t._s(t.$gettext("Итого"))+":\n            "+t._s(r.amount)+"\n            "+t._s(t.contract_type.values.currency_symbol)+"\n          ")])],1):t._e()])]):"total_course"===r.rule.type?a("div",[a("ul",{staticClass:"normalized"},[a("li",[t._v("\n          "+t._s(t.$gettext("Цена за"))+"\n          "+t._s(r.course.simple_name)+":\n          "+t._s(r.rule.total_price)+"\n          "+t._s(t.contract_type.values.currency_symbol)+"\n        ")])])]):t._e(),t._v(" "),t._l(t.invoice_period_report.courses_by_month,(function(r,o){return a("div",{key:o},[a("ul",{staticClass:"normalized"},[a("li",[t._v("\n          "+t._s(r.name)+"\n          "+t._s(r.hours)+"\n          "+t._s(t.$gettext("ч"))+" ⨯\n          "+t._s(r.price)+"\n          "+t._s(t.contract_type.values.currency_symbol)+" =\n          "+t._s(r.amount)+"\n          "+t._s(t.contract_type.values.currency_symbol)+"\n        ")])])])}))],2)}))],2)}),[],!1,null,null,null).exports},props:{invoice_by_month:{required:!0,type:Et.a},contract_type:{type:rn.a,required:!0}},data:function data(){return{invoice_period_reports:this.invoice_by_month.json_report_exist&&function period_reports_factory(t){var r=Object(T.f)(t,(function(t){return t.month})),a=[],o=function _loop(t){var o=r[t].filter((function(r){return r.month===t})),c=new _n(t,o);a.push(c)};for(var c in r)o(c);return a}(this.invoice_by_month.values.json_report.sub_invoices)}}},mn=Object(M.a)(fn,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("popover",{attrs:{trigger:"hover"},scopedSlots:t._u([{key:"popover",fn:function(){return[t.invoice_by_month.json_report_exist?a("div",{staticClass:"modern-page"},[a("div",{staticClass:"mb"},t._l(t.invoice_period_reports,(function(r){return a("InvoicePeriodReport",{key:r.uid,attrs:{invoice_period_report:r,contract_type:t.contract_type}})})),1),t._v(" "),a("div",{staticClass:"text-label"},[t._v("\n        "+t._s(t.$gettext("Итого"))+":\n        "+t._s(t.invoice_by_month.values.json_report.sub_total)+"\n        "+t._s(t.contract_type.currency_symbol)+"\n      ")])]):a("div",{domProps:{innerHTML:t._s(t.invoice_by_month.values.report)}})]},proxy:!0}])},[a("span",{staticClass:"text-dashed clickable",attrs:{"data-role":"trigger"}},[t._v("\n    "+t._s(t._f("money_field")(-t.invoice_by_month.values.fee))+" "+t._s(t.contract_type.currency_symbol)+"\n  ")])])}),[],!1,null,null,null).exports,hn={name:"BalanceAmountFieldFunctional",props:{balance:{required:!0,type:Nt}}},vn=Object(M.a)(hn,(function(t,r){var a=r._c;return r.props.balance.values.amount<0?a("span",{staticClass:"text-danger"},[r._v(r._s(r._f("money_field")(r.props.balance.values.amount)))]):a("span",[r._v(r._s(r._f("money_field")(r.props.balance.values.amount))+" "+r._s(r.props.balance.currency_symbol))])}),[],!0,null,null,null).exports,yn={name:"FromBalanceTransferField",props:{balance_transfer:{required:!0}},computed:{transfer_reason:function transfer_reason(){var t=this.balance_transfer.values.to_contract_balance_by_month;if(!t||!this.$store.state.models.contracts[t.contract_id])return"";var r=new g.a(this.$store.state.models.contracts[t.contract_id],this.$store.state);return"".concat(this.$gettext("Перенос на")," ").concat(this.$moment(t.month).format("MMMM YYYY"),"\n         ").concat(this.$gettext("по договору")," ").concat(r.values.contract_number)}}},bn=Object(M.a)(yn,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("popover",{attrs:{trigger:"hover"},scopedSlots:t._u([{key:"popover",fn:function(){return[a("div",{staticClass:"modern-page"},[t._v("\n      "+t._s(t.transfer_reason)+"\n    ")])]},proxy:!0}])},[a("span",{staticClass:"text-dashed clickable",attrs:{"data-role":"trigger"}},[t._v("\n    "+t._s(t._f("money_field")(-t.balance_transfer.amount))+"\n  ")])])}),[],!1,null,null,null).exports,gn={name:"ToBalanceTransferField",props:{balance_transfer:{required:!0}},computed:{transfer_reason:function transfer_reason(){var t=this.balance_transfer.values.from_contract_balance_by_month;if(!t)return"";var r=new g.a(this.$store.state.models.contracts[t.contract_id],this.$store.state);return"".concat(this.$gettext("Перенос c")," ").concat(this.$moment(t.month).format("MMMM YYYY"),"\n         ").concat(this.$gettext("по договору")," ").concat(r.values.contract_number)}}};var Cn={name:"ContractBalancesByMonthTable",components:{ToBalanceTransferField:Object(M.a)(gn,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("popover",{attrs:{trigger:"hover"},scopedSlots:t._u([{key:"popover",fn:function(){return[a("div",{staticClass:"modern-page"},[t._v("\n      "+t._s(t.transfer_reason)+"\n    ")])]},proxy:!0}])},[a("span",{staticClass:"text-dashed clickable",attrs:{"data-role":"trigger"}},[t._v("\n    "+t._s(t._f("money_field")(t.balance_transfer.amount))+"\n  ")])])}),[],!1,null,null,null).exports,FromBalanceTransferField:bn,BalanceAmountFieldFunctional:vn,CashTransferField:sn,InvoiceByMonthField:mn,CorrectionField:cn,TableHeader:O.a,TableRow:P.a},props:{balances:{required:!0,type:Array}},data:function data(){return{table_columns:(t=(new S.c).add_columns([new S.b("contract",Object(I.$gettext)("Договор")),new S.b("period",Object(I.$gettext)("Расчётный период")),new S.b("accrual",Object(I.$gettext)("Начисление")),new S.b("correction",Object(I.$gettext)("Коррекция")),new S.b("total",Object(I.$gettext)("Итого к оплате")),new S.b("receipt",Object(I.$gettext)("Поступление")),new S.b("balance",Object(I.$gettext)("Баланс"))]),new S.a("contract_balances:columns",t))};var t}},xn=Object(M.a)(Cn,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",{staticClass:"table-responsive"},[a("table",{staticClass:"table-modern"},[a("thead",[a("TableHeader",{attrs:{table_columns:t.table_columns}})],1),t._v(" "),a("tbody",{staticClass:"to-top"},t._l(t.balances,(function(r){return a("TableRow",{key:r.id,attrs:{columns:t.table_columns.columns},scopedSlots:t._u([{key:"contract",fn:function(){return[t._v(t._s(r.contract.values.contract_number))]},proxy:!0},{key:"period",fn:function(){return[t._v(t._s(r.period))]},proxy:!0},{key:"accrual",fn:function(){return[a("div",{staticClass:"flex-column"},t._l(r.to_invoices_by_month,(function(t){return a("InvoiceByMonthField",{key:t.uid,attrs:{invoice_by_month:t,contract_type:r.contract.contract_type}})})),1)]},proxy:!0},{key:"correction",fn:function(){return[a("div",{staticClass:"flex-column"},[t._l(r.to_balance_transfers,(function(t){return a("ToBalanceTransferField",{key:t.uid,attrs:{balance_transfer:t}})})),t._v(" "),t._l(r.from_balance_transfers,(function(t){return a("FromBalanceTransferField",{key:t.uid,attrs:{balance_transfer:t}})})),t._v(" "),t._l(r.to_sickness_certificate_transfers,(function(t){return a("CashTransferField",{key:t.uid,attrs:{cash_transfer:t,contract_type:r.contract.contract_type}})})),t._v(" "),t._l(r.corrections,(function(t){return a("CorrectionField",{key:t.uid,attrs:{correction:t}})}))],2)]},proxy:!0},{key:"total",fn:function(){return[t._v(t._s(t._f("money_field")(r.total_amount))+" "+t._s(r.currency_symbol))]},proxy:!0},{key:"receipt",fn:function(){return[a("div",{staticClass:"flex-column"},t._l(r.to_payments_transfers,(function(t){return a("CashTransferField",{key:t.uid,attrs:{contract_type:r.contract.contract_type,cash_transfer:t}})})),1)]},proxy:!0},{key:"balance",fn:function(){return[a("BalanceAmountFieldFunctional",{attrs:{balance:r}})]},proxy:!0}],null,!0)})})),1)])])}),[],!1,null,null,null).exports,kn={name:"ContractBalancesByMonthDetail",components:{ModernCollapsiblePanel:k.a,ContractBalancesByMonthTable:xn,ListFetcher:u.a},data:function data(){return{ContractBalanceByMonthData:Nt,contract_balance_by_month_model:Ot.a,balances_filter:[{orderBy:"-month,-month_end",schema:JSON.stringify(wt.a)}]}}},wn=Object(M.a)(kn,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("ModernCollapsiblePanel",{staticClass:"resizable-padding",scopedSlots:t._u([{key:"title",fn:function(){return[a("div",{staticClass:"h4 m-none"},[t._v("\n      "+t._s(t.$gettext("Детализация счетов"))+"\n    ")])]},proxy:!0}])},[t._v(" "),a("ListFetcher",{attrs:{url:"api:balance_by_month_extended_list_api",limit:"5",use_modern_paginator:"",model:t.contract_balance_by_month_model,data_presenter:t.ContractBalanceByMonthData,filters:t.balances_filter},scopedSlots:t._u([{key:"default",fn:function(r){var o=r.data;return[o.length?a("ContractBalancesByMonthTable",{attrs:{balances:o}}):t._e()]}},{key:"empty_list",fn:function(){return[a("div",{staticClass:"text-color-caption"},[t._v("\n        "+t._s(t.$gettext("У вас пока нет активных счетов"))+"\n      ")])]},proxy:!0}])})],1)}),[],!1,null,null,null).exports,On=new(a(6).a)("trusted_payments"),Pn=function(){function TrustedPaymentData(t,r){p()(this,TrustedPaymentData),this.state=r,this.values=t,this.id=t.id,this.uid="trusted_payment:".concat(this.id)}return h()(TrustedPaymentData,[{key:"reason",get:function get(){return{maternity_fund:Object(I.$gettext)("материнский капитал")}[this.values.reason]}},{key:"status",get:function get(){return Ft.f[this.values.status]}},{key:"status_label_color",get:function get(){return Ft.d[this.values.status]}}]),TrustedPaymentData}(),jn={fields:["id","fee","reason","status","date_till"]};var $n={name:"TrustedPaymentsPanelTitle",components:{ModernHelp:J}},Sn=Object(M.a)($n,(function(){var t=this.$createElement,r=this._self._c||t;return r("div",{staticClass:"h4 m-none flex flex-vertical-center gap-standart"},[r("span",[this._v("\n    "+this._s(this.$gettext("Отсроченный платеж"))+"\n  ")]),this._v(" "),r("ModernHelp",{attrs:{custom_classes:"popover-fixed-width"}},[this._v("\n    "+this._s(this.$gettext("Платежи, которые ожидают поступления из фондов — например, материнский капитал."))+"\n  ")])],1)}),[],!1,null,null,null).exports,Bn={name:"TrustedPaymentRow",components:{TableRow:P.a},props:{trusted_payment:{type:Pn,required:!0},applied_columns:{required:!0,type:S.a}}};var Mn={name:"TrustedPaymentsTable",components:{TrustedPaymentRow:Object(M.a)(Bn,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("TableRow",{attrs:{columns:t.applied_columns.columns},scopedSlots:t._u([{key:"fee",fn:function(){return[t._v("\n    "+t._s(t._f("money_field")(t.trusted_payment.values.fee))+"\n  ")]},proxy:!0},{key:"reason",fn:function(){return[t._v("\n    "+t._s(t.trusted_payment.reason)+"\n  ")]},proxy:!0},{key:"date_till",fn:function(){return[t._v("\n    "+t._s(t._f("moment")(t.trusted_payment.values.date_till,"LL"))+"\n  ")]},proxy:!0},{key:"status",fn:function(){return[a("span",{class:["modern-label","modern-label-point","modern-label-"+t.trusted_payment.status_label_color]},[t._v("\n      "+t._s(t.trusted_payment.status)+"\n    ")])]},proxy:!0}])})}),[],!1,null,null,null).exports,TableHeader:O.a},props:{trusted_payments:{type:Array,required:!0,validate:Object(T.a)(Pn)}},data:function data(){return{table_columns:(t=(new S.c).add_columns([new S.b("fee",Object(I.$gettext)("Сумма")),new S.b("date_till",Object(I.$gettext)("Ожидаемая дата")),new S.b("status",Object(I.$gettext)("Статус")),new S.b("reason",Object(I.$gettext)("Причина"))]),new S.a("trusted_payments:columns",t))};var t}},Dn=Object(M.a)(Mn,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("div",{staticClass:"table-responsive"},[a("table",{staticClass:"table-modern"},[a("thead",[a("TableHeader",{attrs:{table_columns:t.table_columns}})],1),t._v(" "),a("tbody",t._l(t.trusted_payments,(function(r){return a("TrustedPaymentRow",{key:r.id,attrs:{trusted_payment:r,applied_columns:t.table_columns}})})),1)])])}),[],!1,null,null,null).exports,Tn={name:"TrustedPayments",components:{TrustedPaymentsPanelTitle:Sn,ModernCollapsiblePanel:k.a,ListFetcher:u.a,TrustedPaymentsTable:Dn},data:function data(){return{trusted_payment_model:On,TrustedPaymentData:Pn}},methods:{get_trusted_payments_filters:function get_trusted_payments_filters(){return[{applied:{schema:JSON.stringify(jn)}}]}}},En=Object(M.a)(Tn,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("ModernCollapsiblePanel",{staticClass:"resizable-padding",scopedSlots:t._u([{key:"title",fn:function(){return[a("TrustedPaymentsPanelTitle")]},proxy:!0}])},[t._v(" "),a("ListFetcher",{attrs:{url:"api:trusted_payment_list_api",limit:"5",use_modern_paginator:"",model:t.trusted_payment_model,data_presenter:t.TrustedPaymentData,filters:t.get_trusted_payments_filters()},scopedSlots:t._u([{key:"default",fn:function(r){var o=r.data;return[o.length?a("TrustedPaymentsTable",{attrs:{trusted_payments:o}}):t._e()]}},{key:"empty_list",fn:function(){return[a("div",{staticClass:"text-color-caption"},[t._v("\n        "+t._s(t.$gettext("У вас пока нет отсроченных платежей"))+"\n      ")])]},proxy:!0}])})],1)}),[],!1,null,null,null).exports,qn=a(215),Rn={name:"ClientContractsFetcher",components:{ListFetcher:u.a},data:function data(){return{contract_filters:[{applied:{orderBy:"-date_from",schema:JSON.stringify(qn.f),contract_type__is_offer:!1}}],contract_model:mt.a,ContractData:g.a}}},Ln=Object(M.a)(Rn,(function(){var t=this,r=t.$createElement;return(t._self._c||r)("ListFetcher",{attrs:{url:"api:contract_client_list_api",model:t.contract_model,data_presenter:t.ContractData,filters:t.contract_filters},scopedSlots:t._u([{key:"default",fn:function(r){var a=r.data;return[t._t("default",null,{contracts:a})]}}],null,!0)})}),[],!1,null,null,null).exports,An=(a(53),a(96),a(764),a(1713)),In=a(1678),Fn=a(1987),Nn=a(50),Qn={name:"FinancesGetForClickBanner",components:{ListFetcher:u.a},data:function data(){var t=this.$route.query.orderId;return{order_id:t,order_uid:"get_for_click:order_id",is_show_banner:!0,is_existing_order:!0,payment_order:null,payment_order_filters:[{applied:{order_id:t,schema:JSON.stringify(Fn.a)}}],payment_order_model:An.a,link:window.PARTNER_LINK||localStorage.getItem("PARTNER_LINK"),event_name:window.PARTNER_GTM_EVENT_NAME||localStorage.getItem("PARTNER_GTM_EVENT_NAME")}},methods:{close:function close(){this.$router.replace({query:null}),this.is_show_banner=!1},choose:function choose(){this.event_name&&Object(Nn.a)(this.event_name),this.close();var t=document.createElement("a");t.href=this.link,t.target="_blank",t.click()},check_order_validity:function check_order_validity(t){if(t.ids.length){var r=t.ids[0];this.payment_order=new In.a(this.$store.state.models.payment_orders[r],this.$store.state),this.$moment(this.payment_order.values.created_at).isBefore(this.$moment().subtract("1","days"))&&(this.is_show_banner=!1)}else this.is_existing_order=!1}},created:function created(){if(this.order_id){var t=JSON.parse(localStorage.getItem(this.order_uid));this.order_id===t?this.is_show_banner=!1:localStorage.setItem(this.order_uid,JSON.stringify(this.order_id))}}},Hn={name:"ClientContractsRoot",components:{ClientContractsFetcher:Ln,ContractBalancesByMonth:Xe,ContractBalancesByMonthDetail:wn,PaymentsList:nn,ClientContracts:kt,TrustedPayments:En,SicknessCertificatesRoot:W,FinancesGetForClickBanner:Object(M.a)(Qn,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return t.link&&t.order_id&&t.is_existing_order&&t.is_show_banner?a("ListFetcher",{attrs:{url:"api:payment_order_list_api",limit:"1",filters:t.payment_order_filters,model:t.payment_order_model},on:{fetched:t.check_order_validity}},[a("div",{staticClass:"finances-banner"},[a("div",{staticClass:"flex flex-space-between"},[a("div",{staticClass:"finances-banner__text-container"},[a("div",[a("h4",{staticClass:"mt-none mb-xs"},[a("span",[t._v("\n            "+t._s(t.$gettext("Вам доступен"))+"\n          ")]),t._v(" "),a("span",{staticClass:"text-primary"},[t._v("(1)")]),t._v(" "),a("span",[t._v("\n            "+t._s(t.$gettext("подарок"))+"\n          ")])]),t._v(" "),a("div",{staticClass:"text-subtext-color"},[t._v("\n            "+t._s(t.$gettext("Выберите подарок от наших партнеров!"))+"\n          ")])]),t._v(" "),a("button",{staticClass:"btn-modern-primary flex-self-start",on:{click:t.choose}},[t._v("\n          "+t._s(t.$gettext("Выбрать"))+"\n        ")])]),t._v(" "),a("div",{staticClass:"finances-banner__cone-container"},[a("div",{staticClass:"finances-banner__cone"},[a("div",{staticClass:"banner-label"},[t._v("\n            "+t._s(t.$gettext("подарок"))+"\n          ")]),t._v(" "),a("img",{attrs:{src:"/static/img/talking_cones/like_simple_cone.png"}})])])]),t._v(" "),a("i",{staticClass:"shp_icons-close_circle_filled text-grey-dark finances-banner__close-icon",on:{click:t.close}})])]):t._e()}),[],!1,null,null,null).exports},data:function data(){return{balances_key:0}},methods:{get_actual_contracts:function get_actual_contracts(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.filter((function(t){var r=It()(t.values.date_till).add(3,"months").isAfter(It()());return t.values.balance<0||r}))}}},zn=Object(M.a)(Hn,(function(){var t=this,r=t.$createElement,a=t._self._c||r;return a("ClientContractsFetcher",{scopedSlots:t._u([{key:"default",fn:function(r){var o=r.contracts;return[a("div",{staticClass:"client-finances-container"},[a("div",{staticClass:"client-finances-details"},[a("ClientContracts",{attrs:{contracts:o},on:{contract_updated:function(r){t.balances_key++}}}),t._v(" "),a("ContractBalancesByMonthDetail"),t._v(" "),a("PaymentsList"),t._v(" "),a("TrustedPayments"),t._v(" "),a("SicknessCertificatesRoot",{attrs:{contracts:t.get_actual_contracts(o)}})],1),t._v(" "),a("div",{staticClass:"client-finances-payment"},[a("ContractBalancesByMonth",{attrs:{watch_key:t.balances_key}}),t._v(" "),a("FinancesGetForClickBanner",{staticClass:"mt"})],1)])]}}])})}),[],!1,null,null,null);r.default=zn.exports},50:function(t,r,a){"use strict";function gtm_track(t){window.dataLayer?window.dataLayer.push({event:t}):console.log("%cgtm_tracking, no tracking, "+t,"color:red;")}a.d(r,"a",(function(){return gtm_track}))},755:function(t,r,a){"use strict";a.d(r,"a",(function(){return i})),a.d(r,"b",(function(){return l})),a.d(r,"c",(function(){return update_model_solve_types}));a(7),a(28),a(70),a(82),a(41),a(88),a(29),a(53),a(36),a(116),a(117),a(11),a(12);var o=a(0),c=a(375);function _createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,c=function F(){};return{s:c,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,u=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return l=t.done,t},e:function e(t){u=!0,i=t},f:function f(){try{l||null==a.return||a.return()}finally{if(u)throw i}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}var i=[["tex","latex"],["html","html"]],l={tex:"latex",html:"html",text:Object(o.$gettext)("текст"),bbcode:"bbcode"};function update_model_solve_types(t){var r,a=_createForOfIteratorHelper(c.d);try{for(a.s();!(r=a.n()).done;){var o=r.value;t[o[0]]=!1}}catch(t){a.e(t)}finally{a.f()}return(t.solve_types||[]).forEach((function(r){t[r]=!0})),t}},756:function(t,r,a){"use strict";a.d(r,"a",(function(){return icon_by_extension_and_mime}));for(var o={},c=0,i=["bmp.png","png.png","html.png","txt.png","mov.png","mpeg.png","psd.png","zip.png","jpg.png","PL.png","wmv.png","mp4.png","wma.png","gif.png","rar.png","wav.png","doc.png","docx.png","avi.png","css.png","pdf.png","tiff.png","mp3.png","xlsx.png","xls.png","pptx.png","ppt.png","proj.png","pst.png","pub.png","readme.png","vsd.png","midi.png","ini.png","fla.png","accdb.png","settings.png","url.png","jsf.png","ods.png"];c<i.length;c++){var l=i[c];o[l.split(".")[0]]=l}function icon_by_extension_and_mime(t,r){var a=o[t.toLowerCase()];return a||(r.indexOf("audio/")>=0?a="audio.png":r.indexOf("video/")>=0?a="video.png":r.indexOf("image/")>=0?a="image.png":r.indexOf("text")>=0&&(a="text.png")),function path(t){return"/static/file_icons/"+t}(a||"unknown.png")}}}]);
//# sourceMappingURL=115.115.f59c07bae6ddfb9e16e9.js.map